var ta=Object.defineProperty;var f=(t,a)=>ta(t,"name",{value:a,configurable:!0});var aa=Object.create,ft=Object.defineProperty,sa=Object.getOwnPropertyDescriptor,na=Object.getOwnPropertyNames,ia=Object.getPrototypeOf,ea=Object.prototype.hasOwnProperty,oa=f((t,a,s)=>a in t?ft(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,"Qe"),W=f((t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports),"K"),xt=f((t,a)=>{for(var s in a)ft(t,s,{get:a[s],enumerable:!0})},"ur"),ra=f((t,a,s,n)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of na(a))!ea.call(t,i)&&i!==s&&ft(t,i,{get:f(()=>a[i],"get"),enumerable:!(n=sa(a,i))||n.enumerable});return t},"$e"),P=f((t,a,s)=>(s=t!=null?aa(ia(t)):{},ra(ft(s,"default",{value:t,enumerable:!0}),t)),"Q"),R=f((t,a,s)=>(oa(t,typeof a!="symbol"?a+"":a,s),s),"$"),ha=W((t,a)=>{function s(n){for(var i=new Array(n),e=0;e<n;++e)i[e]=e;return i}f(s,"He"),a.exports=s}),ua=W((t,a)=>{a.exports=function(i){return i!=null&&(s(i)||n(i)||!!i._isBuffer)};function s(i){return!!i.constructor&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}f(s,"Dr");function n(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&s(i.slice(0,0))}f(n,"We")}),ht=W((t,a)=>{var s=ha(),n=ua(),i=typeof Float64Array<"u";function e(d,c){return d[0]-c[0]}f(e,"Je");function o(){var d=this.stride,c=new Array(d.length),l;for(l=0;l<c.length;++l)c[l]=[Math.abs(d[l]),l];c.sort(e);var y=new Array(c.length);for(l=0;l<y.length;++l)y[l]=c[l][1];return y}f(o,"rn");function h(d,c){var l=["View",c,"d",d].join("");c<0&&(l="View_Nil"+d);var y=d==="generic";if(c===-1){var m="function "+l+"(a){this.data=a;};var proto="+l+".prototype;proto.dtype='"+d+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+l+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+l+"(a){return new "+l+"(a);}",z=new Function(m);return z()}else if(c===0){var m="function "+l+"(a,d) {this.data = a;this.offset = d};var proto="+l+".prototype;proto.dtype='"+d+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+l+"_copy() {return new "+l+"(this.data,this.offset)};proto.pick=function "+l+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+l+"_get(){return "+(y?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+l+"_set(v){return "+(y?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+l+"(a,b,c,d){return new "+l+"(a,d)}",z=new Function("TrivialArray",m);return z(u[d][0])}var m=["'use strict'"],g=s(c),b=g.map(function(q){return"i"+q}),_="this.offset+"+g.map(function(q){return"this.stride["+q+"]*i"+q}).join("+"),v=g.map(function(q){return"b"+q}).join(","),M=g.map(function(q){return"c"+q}).join(",");m.push("function "+l+"(a,"+v+","+M+",d){this.data=a","this.shape=["+v+"]","this.stride=["+M+"]","this.offset=d|0}","var proto="+l+".prototype","proto.dtype='"+d+"'","proto.dimension="+c),m.push("Object.defineProperty(proto,'size',{get:function "+l+"_size(){return "+g.map(function(q){return"this.shape["+q+"]"}).join("*"),"}})"),c===1?m.push("proto.order=[0]"):(m.push("Object.defineProperty(proto,'order',{get:"),c<4?(m.push("function "+l+"_order(){"),c===2?m.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):c===3&&m.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):m.push("ORDER})")),m.push("proto.set=function "+l+"_set("+b.join(",")+",v){"),y?m.push("return this.data.set("+_+",v)}"):m.push("return this.data["+_+"]=v}"),m.push("proto.get=function "+l+"_get("+b.join(",")+"){"),y?m.push("return this.data.get("+_+")}"):m.push("return this.data["+_+"]}"),m.push("proto.index=function "+l+"_index(",b.join(),"){return "+_+"}"),m.push("proto.hi=function "+l+"_hi("+b.join(",")+"){return new "+l+"(this.data,"+g.map(function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")}).join(",")+","+g.map(function(q){return"this.stride["+q+"]"}).join(",")+",this.offset)}");var x=g.map(function(q){return"a"+q+"=this.shape["+q+"]"}),k=g.map(function(q){return"c"+q+"=this.stride["+q+"]"});m.push("proto.lo=function "+l+"_lo("+b.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+k.join(","));for(var w=0;w<c;++w)m.push("if(typeof i"+w+"==='number'&&i"+w+">=0){d=i"+w+"|0;b+=c"+w+"*d;a"+w+"-=d}");m.push("return new "+l+"(this.data,"+g.map(function(q){return"a"+q}).join(",")+","+g.map(function(q){return"c"+q}).join(",")+",b)}"),m.push("proto.step=function "+l+"_step("+b.join(",")+"){var "+g.map(function(q){return"a"+q+"=this.shape["+q+"]"}).join(",")+","+g.map(function(q){return"b"+q+"=this.stride["+q+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var w=0;w<c;++w)m.push("if(typeof i"+w+"==='number'){d=i"+w+"|0;if(d<0){c+=b"+w+"*(a"+w+"-1);a"+w+"=ceil(-a"+w+"/d)}else{a"+w+"=ceil(a"+w+"/d)}b"+w+"*=d}");m.push("return new "+l+"(this.data,"+g.map(function(q){return"a"+q}).join(",")+","+g.map(function(q){return"b"+q}).join(",")+",c)}");for(var A=new Array(c),j=new Array(c),w=0;w<c;++w)A[w]="a[i"+w+"]",j[w]="b[i"+w+"]";m.push("proto.transpose=function "+l+"_transpose("+b+"){"+b.map(function(q,N){return q+"=("+q+"===undefined?"+N+":"+q+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+l+"(this.data,"+A.join(",")+","+j.join(",")+",this.offset)}"),m.push("proto.pick=function "+l+"_pick("+b+"){var a=[],b=[],c=this.offset");for(var w=0;w<c;++w)m.push("if(typeof i"+w+"==='number'&&i"+w+">=0){c=(c+this.stride["+w+"]*i"+w+")|0}else{a.push(this.shape["+w+"]);b.push(this.stride["+w+"])}");m.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),m.push("return function construct_"+l+"(data,shape,stride,offset){return new "+l+"(data,"+g.map(function(q){return"shape["+q+"]"}).join(",")+","+g.map(function(q){return"stride["+q+"]"}).join(",")+",offset)}");var z=new Function("CTOR_LIST","ORDER",m.join(`
`));return z(u[d],o)}f(h,"en");function r(d){if(n(d))return"buffer";if(i)switch(Object.prototype.toString.call(d)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(d)?"array":"generic"}f(r,"nn");var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function p(d,c,l,y){if(d===void 0){var M=u.array[0];return M([])}else typeof d=="number"&&(d=[d]);c===void 0&&(c=[d.length]);var m=c.length;if(l===void 0){l=new Array(m);for(var g=m-1,b=1;g>=0;--g)l[g]=b,b*=c[g]}if(y===void 0){y=0;for(var g=0;g<m;++g)l[g]<0&&(y-=(c[g]-1)*l[g])}for(var _=r(d),v=u[_];v.length<=m+1;)v.push(h(_,v.length-1));var M=v[m+1];return M(d,c,l,y)}f(p,"an"),a.exports=p}),la=W((t,a)=>{function s(e,o){for(var h=1,r=e.length,u=e[0],p=e[0],d=1;d<r;++d)if(p=u,u=e[d],o(u,p)){if(d===h){h++;continue}e[h++]=u}return e.length=h,e}f(s,"tn");function n(e){for(var o=1,h=e.length,r=e[0],u=e[0],p=1;p<h;++p,u=r)if(u=r,r=e[p],r!==u){if(p===o){o++;continue}e[o++]=r}return e.length=o,e}f(n,"sn");function i(e,o,h){return e.length===0?e:o?(h||e.sort(o),s(e,o)):(h||e.sort(),n(e))}f(i,"on"),a.exports=i}),ca=W((t,a)=>{var s=la();function n(u,p,d){var c=u.length,l=p.arrayArgs.length,y=p.indexArgs.length>0,m=[],g=[],b=0,_=0,v,M;for(v=0;v<c;++v)g.push(["i",v,"=0"].join(""));for(M=0;M<l;++M)for(v=0;v<c;++v)_=b,b=u[v],v===0?g.push(["d",M,"s",v,"=t",M,"p",b].join("")):g.push(["d",M,"s",v,"=(t",M,"p",b,"-s",_,"*t",M,"p",_,")"].join(""));for(g.length>0&&m.push("var "+g.join(",")),v=c-1;v>=0;--v)b=u[v],m.push(["for(i",v,"=0;i",v,"<s",b,";++i",v,"){"].join(""));for(m.push(d),v=0;v<c;++v){for(_=b,b=u[v],M=0;M<l;++M)m.push(["p",M,"+=d",M,"s",v].join(""));y&&(v>0&&m.push(["index[",_,"]-=s",_].join("")),m.push(["++index[",b,"]"].join(""))),m.push("}")}return m.join(`
`)}f(n,"jr");function i(u,p,d,c){for(var l=p.length,y=d.arrayArgs.length,m=d.blockSize,g=d.indexArgs.length>0,b=[],_=0;_<y;++_)b.push(["var offset",_,"=p",_].join(""));for(var _=u;_<l;++_)b.push(["for(var j"+_+"=SS[",p[_],"]|0;j",_,">0;){"].join("")),b.push(["if(j",_,"<",m,"){"].join("")),b.push(["s",p[_],"=j",_].join("")),b.push(["j",_,"=0"].join("")),b.push(["}else{s",p[_],"=",m].join("")),b.push(["j",_,"-=",m,"}"].join("")),g&&b.push(["index[",p[_],"]=j",_].join(""));for(var _=0;_<y;++_){for(var v=["offset"+_],M=u;M<l;++M)v.push(["j",M,"*t",_,"p",p[M]].join(""));b.push(["p",_,"=(",v.join("+"),")"].join(""))}b.push(n(p,d,c));for(var _=u;_<l;++_)b.push("}");return b.join(`
`)}f(i,"cn");function e(u){for(var p=0,d=u[0].length;p<d;){for(var c=1;c<u.length;++c)if(u[c][p]!==u[0][p])return p;++p}return p}f(e,"ln");function o(u,p,d){for(var c=u.body,l=[],y=[],m=0;m<u.args.length;++m){var g=u.args[m];if(!(g.count<=0)){var b=new RegExp(g.name,"g"),_="",v=p.arrayArgs.indexOf(m);switch(p.argTypes[m]){case"offset":var M=p.offsetArgIndex.indexOf(m),x=p.offsetArgs[M];v=x.array,_="+q"+M;case"array":_="p"+v+_;var k="l"+m,w="a"+v;if(p.arrayBlockIndices[v]===0)g.count===1?d[v]==="generic"?g.lvalue?(l.push(["var ",k,"=",w,".get(",_,")"].join("")),c=c.replace(b,k),y.push([w,".set(",_,",",k,")"].join(""))):c=c.replace(b,[w,".get(",_,")"].join("")):c=c.replace(b,[w,"[",_,"]"].join("")):d[v]==="generic"?(l.push(["var ",k,"=",w,".get(",_,")"].join("")),c=c.replace(b,k),g.lvalue&&y.push([w,".set(",_,",",k,")"].join(""))):(l.push(["var ",k,"=",w,"[",_,"]"].join("")),c=c.replace(b,k),g.lvalue&&y.push([w,"[",_,"]=",k].join("")));else{for(var A=[g.name],j=[_],z=0;z<Math.abs(p.arrayBlockIndices[v]);z++)A.push("\\s*\\[([^\\]]+)\\]"),j.push("$"+(z+1)+"*t"+v+"b"+z);if(b=new RegExp(A.join(""),"g"),_=j.join("+"),d[v]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");c=c.replace(b,[w,"[",_,"]"].join(""))}break;case"scalar":c=c.replace(b,"Y"+p.scalarArgs.indexOf(m));break;case"index":c=c.replace(b,"index");break;case"shape":c=c.replace(b,"shape");break}}}return[l.join(`
`),c,y.join(`
`)].join(`
`).trim()}f(o,"xr");function h(u){for(var p=new Array(u.length),d=!0,c=0;c<u.length;++c){var l=u[c],y=l.match(/\d+/);y?y=y[0]:y="",l.charAt(0)===0?p[c]="u"+l.charAt(1)+y:p[c]=l.charAt(0)+y,c>0&&(d=d&&p[c]===p[c-1])}return d?p[0]:p.join("")}f(h,"pn");function r(u,p){for(var d=p[1].length-Math.abs(u.arrayBlockIndices[0])|0,c=new Array(u.arrayArgs.length),l=new Array(u.arrayArgs.length),y=0;y<u.arrayArgs.length;++y)l[y]=p[2*y],c[y]=p[2*y+1];for(var m=[],g=[],b=[],_=[],v=[],y=0;y<u.arrayArgs.length;++y){u.arrayBlockIndices[y]<0?(b.push(0),_.push(d),m.push(d),g.push(d+u.arrayBlockIndices[y])):(b.push(u.arrayBlockIndices[y]),_.push(u.arrayBlockIndices[y]+d),m.push(0),g.push(u.arrayBlockIndices[y]));for(var M=[],x=0;x<c[y].length;x++)b[y]<=c[y][x]&&c[y][x]<_[y]&&M.push(c[y][x]-b[y]);v.push(M)}for(var k=["SS"],w=["'use strict'"],A=[],x=0;x<d;++x)A.push(["s",x,"=SS[",x,"]"].join(""));for(var y=0;y<u.arrayArgs.length;++y){k.push("a"+y),k.push("t"+y),k.push("p"+y);for(var x=0;x<d;++x)A.push(["t",y,"p",x,"=t",y,"[",b[y]+x,"]"].join(""));for(var x=0;x<Math.abs(u.arrayBlockIndices[y]);++x)A.push(["t",y,"b",x,"=t",y,"[",m[y]+x,"]"].join(""))}for(var y=0;y<u.scalarArgs.length;++y)k.push("Y"+y);if(u.shapeArgs.length>0&&A.push("shape=SS.slice(0)"),u.indexArgs.length>0){for(var j=new Array(d),y=0;y<d;++y)j[y]="0";A.push(["index=[",j.join(","),"]"].join(""))}for(var y=0;y<u.offsetArgs.length;++y){for(var z=u.offsetArgs[y],q=[],x=0;x<z.offset.length;++x)z.offset[x]!==0&&(z.offset[x]===1?q.push(["t",z.array,"p",x].join("")):q.push([z.offset[x],"*t",z.array,"p",x].join("")));q.length===0?A.push("q"+y+"=0"):A.push(["q",y,"=",q.join("+")].join(""))}var N=s([].concat(u.pre.thisVars).concat(u.body.thisVars).concat(u.post.thisVars));A=A.concat(N),A.length>0&&w.push("var "+A.join(","));for(var y=0;y<u.arrayArgs.length;++y)w.push("p"+y+"|=0");u.pre.body.length>3&&w.push(o(u.pre,u,l));var B=o(u.body,u,l),V=e(v);V<d?w.push(i(V,v[0],u,B)):w.push(n(v[0],u,B)),u.post.body.length>3&&w.push(o(u.post,u,l)),u.debug&&console.log("-----Generated cwise routine for ",p,`:
`+w.join(`
`)+`
----------`);var O=[u.funcName||"unnamed","_cwise_loop_",c[0].join("s"),"m",V,h(l)].join(""),Y=new Function(["function ",O,"(",k.join(","),"){",w.join(`
`),"} return ",O].join(""));return Y()}f(r,"fn"),a.exports=r}),fa=W((t,a)=>{var s=ca();function n(i){var e=["'use strict'","var CACHED={}"],o=[],h=i.funcName+"_cwise_thunk";e.push(["return function ",h,"(",i.shimArgs.join(","),"){"].join(""));for(var r=[],u=[],p=[["array",i.arrayArgs[0],".shape.slice(",Math.max(0,i.arrayBlockIndices[0]),i.arrayBlockIndices[0]<0?","+i.arrayBlockIndices[0]+")":")"].join("")],d=[],c=[],l=0;l<i.arrayArgs.length;++l){var y=i.arrayArgs[l];o.push(["t",y,"=array",y,".dtype,","r",y,"=array",y,".order"].join("")),r.push("t"+y),r.push("r"+y),u.push("t"+y),u.push("r"+y+".join()"),p.push("array"+y+".data"),p.push("array"+y+".stride"),p.push("array"+y+".offset|0"),l>0&&(d.push("array"+i.arrayArgs[0]+".shape.length===array"+y+".shape.length+"+(Math.abs(i.arrayBlockIndices[0])-Math.abs(i.arrayBlockIndices[l]))),c.push("array"+i.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,i.arrayBlockIndices[0])+"]===array"+y+".shape[shapeIndex+"+Math.max(0,i.arrayBlockIndices[l])+"]"))}i.arrayArgs.length>1&&(e.push("if (!("+d.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+i.arrayArgs[0]+".shape.length-"+Math.abs(i.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),e.push("if (!("+c.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}"));for(var l=0;l<i.scalarArgs.length;++l)p.push("scalar"+i.scalarArgs[l]);o.push(["type=[",u.join(","),"].join()"].join("")),o.push("proc=CACHED[type]"),e.push("var "+o.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",r.join(","),"])}","return proc(",p.join(","),")}"].join("")),i.debug&&console.log(`-----Generated thunk:
`+e.join(`
`)+`
----------`);var m=new Function("compile",e.join(`
`));return m(s.bind(void 0,i))}f(n,"dn"),a.exports=n}),pa=W((t,a)=>{var s=fa();function n(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}f(n,"mn");function i(e){var o=new n;o.pre=e.pre,o.body=e.body,o.post=e.post;var h=e.args.slice(0);o.argTypes=h;for(var r=0;r<h.length;++r){var u=h[r];if(u==="array"||typeof u=="object"&&u.blockIndices){if(o.argTypes[r]="array",o.arrayArgs.push(r),o.arrayBlockIndices.push(u.blockIndices?u.blockIndices:0),o.shimArgs.push("array"+r),r<o.pre.args.length&&o.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array args");if(r<o.post.args.length&&o.post.args[r].count>0)throw new Error("cwise: post() block may not reference array args")}else if(u==="scalar")o.scalarArgs.push(r),o.shimArgs.push("scalar"+r);else if(u==="index"){if(o.indexArgs.push(r),r<o.pre.args.length&&o.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array index");if(r<o.body.args.length&&o.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array index");if(r<o.post.args.length&&o.post.args[r].count>0)throw new Error("cwise: post() block may not reference array index")}else if(u==="shape"){if(o.shapeArgs.push(r),r<o.pre.args.length&&o.pre.args[r].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(r<o.body.args.length&&o.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array shape");if(r<o.post.args.length&&o.post.args[r].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if(typeof u=="object"&&u.offset)o.argTypes[r]="offset",o.offsetArgs.push({array:u.array,offset:u.offset}),o.offsetArgIndex.push(r);else throw new Error("cwise: Unknown argument type "+h[r])}if(o.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(o.pre.args.length>h.length)throw new Error("cwise: Too many arguments in pre() block");if(o.body.args.length>h.length)throw new Error("cwise: Too many arguments in body() block");if(o.post.args.length>h.length)throw new Error("cwise: Too many arguments in post() block");return o.debug=!!e.printCode||!!e.debug,o.funcName=e.funcName||"cwise",o.blockSize=e.blockSize||64,s(o)}f(i,"un"),a.exports=i}),ut=W(t=>{var a=pa(),s={body:"",args:[],thisVars:[],localVars:[]};function n(c){if(!c)return s;for(var l=0;l<c.args.length;++l){var y=c.args[l];l===0?c.args[l]={name:y,lvalue:!0,rvalue:!!c.rvalue,count:c.count||1}:c.args[l]={name:y,lvalue:!1,rvalue:!0,count:1}}return c.thisVars||(c.thisVars=[]),c.localVars||(c.localVars=[]),c}f(n,"gr");function i(c){return a({args:c.args,pre:n(c.pre),body:n(c.body),post:n(c.proc),funcName:c.funcName})}f(i,"xn");function e(c){for(var l=[],y=0;y<c.args.length;++y)l.push("a"+y);var m=new Function("P",["return function ",c.funcName,"_ndarrayops(",l.join(","),") {P(",l.join(","),");return a0}"].join(""));return m(i(c))}f(e,"O");var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var c in o){var l=o[c];t[c]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+l+"c"},funcName:c}),t[c+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a"+l+"=b"},rvalue:!0,funcName:c+"eq"}),t[c+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+l+"s"},funcName:c+"s"}),t[c+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a"+l+"=s"},rvalue:!0,funcName:c+"seq"})}})();var h={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var c in h){var l=h[c];t[c]=e({args:["array","array"],body:{args:["a","b"],body:"a="+l+"b"},funcName:c}),t[c+"eq"]=e({args:["array"],body:{args:["a"],body:"a="+l+"a"},rvalue:!0,count:2,funcName:c+"eq"})}})();var r={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var c in r){var l=r[c];t[c]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+l+"c"},funcName:c}),t[c+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+l+"s"},funcName:c+"s"}),t[c+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a=a"+l+"b"},rvalue:!0,count:2,funcName:c+"eq"}),t[c+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+l+"s"},rvalue:!0,count:2,funcName:c+"seq"})}})();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var c=0;c<u.length;++c){var l=u[c];t[l]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:l}),t[l+"eq"]=e({args:["array"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:l+"eq"})}})();var p=["max","min","atan2","pow"];(function(){for(var c=0;c<p.length;++c){var l=p[c];t[l]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:l}),t[l+"s"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:l+"s"}),t[l+"eq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:l+"eq"}),t[l+"seq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:l+"seq"})}})();var d=["atan2","pow"];(function(){for(var c=0;c<d.length;++c){var l=d[c];t[l+"op"]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:l+"op"}),t[l+"ops"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:l+"ops"}),t[l+"opeq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:l+"opeq"}),t[l+"opseq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+l,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:l+"opseq"})}})(),t.any=a({args:["array"],pre:s,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=a({args:["array"],pre:s,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=a({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=a({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=a({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=a({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=e({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=e({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=e({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=a({args:["array","array"],pre:s,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),T=P(ht()),G=P(ut()),C=P(ht()),S=P(ut()),tt,ct=(tt=class{constructor(a,s,n){this._dataNormalized=a,this._minD=s,this._maxD=n}static createFromUnnormalized(a){let s=S.sup(a),n=S.inf(a),i=(0,C.default)(new Float32Array(a.size),a.shape),e=s-n;return e<1e-4?S.assigns(i,0):(S.subs(i,a,n),S.divs(i,i,e)),new ct(i,n,s)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let a=(0,C.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return S.muls(a,this._dataNormalized,this._maxD-this._minD),S.adds(a,a,this._minD),a}},f(tt,"J"),tt),at,L=(at=class{constructor(a,s){this._quantized=a,this._method=s}get quantized(){return this._quantized}static maxIntBits(a){return 2**a-1}static fromNormalized(a,s){let n=a.data,i;if(s==="norm8x"){let e=L.maxIntBits(8),o=(0,C.default)(new Float32Array(n.size),n.shape);S.muls(o,n,e),S.roundeq(o),i=(0,C.default)(new Uint8Array(o.data),n.shape)}else if(s==="norm565"){let e=(0,C.default)(new Float32Array(n.size),n.shape);S.assign(e,n),S.mulseq(e.pick(null,0),L.maxIntBits(5)),S.mulseq(e.pick(null,1),L.maxIntBits(6)),S.mulseq(e.pick(null,2),L.maxIntBits(5)),S.roundeq(e);let o=(0,C.default)(new Uint16Array(e.data),n.shape),h=(0,C.default)(new Uint16Array(n.shape[0]),[n.shape[0]]),r=(0,C.default)(new Uint16Array(n.shape[0]),[n.shape[0]]);S.lshifts(h,o.pick(null,0),11),S.lshifts(r,o.pick(null,1),5),S.boreq(h,r),S.boreq(h,o.pick(null,2)),i=h}else{let e=(0,C.default)(new Float32Array(n.size),n.shape);S.assign(e,n),S.mulseq(e.pick(null,0),L.maxIntBits(11)),S.mulseq(e.pick(null,1),L.maxIntBits(10)),S.mulseq(e.pick(null,2),L.maxIntBits(11)),S.roundeq(e);let o=(0,C.default)(new Uint32Array(e.data),n.shape),h=(0,C.default)(new Uint32Array(n.shape[0]),[n.shape[0]]),r=(0,C.default)(new Uint32Array(n.shape[0]),[n.shape[0]]);S.lshifts(h,o.pick(null,0),21),S.lshifts(r,o.pick(null,1),11),S.boreq(h,r),S.boreq(h,o.pick(null,2)),i=h}return new L(i,s)}dequantize(a,s){let n=this._method,i,e=this._quantized;if(n==="norm8x"){let o=L.maxIntBits(8);i=(0,C.default)(new Float32Array(e.size),e.shape),S.muls(i,e,1/o)}else if(n==="norm565"){let o=(0,C.default)(new Uint8Array(e.shape[0]),[e.shape[0]]),h=(0,C.default)(new Uint8Array(e.shape[0]),[e.shape[0]]),r=(0,C.default)(new Uint8Array(e.shape[0]),[e.shape[0]]);S.rrshifts(o,e,11),S.rrshifts(h,e,5),S.bandseq(h,L.maxIntBits(6)),S.bands(r,e,L.maxIntBits(5)),i=(0,C.default)(new Float32Array(e.shape[0]*3),[e.shape[0],3]),S.muls(i.pick(null,0),o,1/L.maxIntBits(5)),S.muls(i.pick(null,1),h,1/L.maxIntBits(6)),S.muls(i.pick(null,2),r,1/L.maxIntBits(5))}else{let o=(0,C.default)(new Uint16Array(e.shape[0]),[e.shape[0]]),h=(0,C.default)(new Uint16Array(e.shape[0]),[e.shape[0]]),r=(0,C.default)(new Uint16Array(e.shape[0]),[e.shape[0]]);S.rrshifts(o,e,21),S.rrshifts(h,e,11),S.bandseq(h,L.maxIntBits(10)),S.bands(r,e,L.maxIntBits(11)),i=(0,C.default)(new Float32Array(e.shape[0]*3),[e.shape[0],3]),S.muls(i.pick(null,0),o,1/L.maxIntBits(11)),S.muls(i.pick(null,1),h,1/L.maxIntBits(10)),S.muls(i.pick(null,2),r,1/L.maxIntBits(11))}return new ct(i,a,s)}},f(at,"D"),at),st,U=(st=class{constructor(a,s,n,i,e,o=!1){this._quantized=a,this._minMaxMatrix=s,this._chunkSize=n,this._quantizationMethod=i,this._variableChunkSize=e,this._isDynamicChunks=o}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(a){let s=a.length,n=this.minmaxMatrix.shape[0]-s,i=(0,T.default)(new Float32Array(n*2),[n,2]),e=0,o=n,h=0,r=this.minmaxMatrix.shape[0];for(let u=0;u<a.length;u++)r=a[u],o=r-h+e,o>e&&G.assign(i.hi(o,2).lo(e,0),this.minmaxMatrix.hi(r,2).lo(h,0)),e=o,h=r+1;return e<n&&G.assign(i.lo(e,0),this.minmaxMatrix.lo(h,0)),i}_createPrunedQuantized(a){let s=a.length,n=this.quantized.shape[0]-s,i=this._quantizationMethod,e,o;if(i==="norm8x"){o=this._quantized.shape[1];let d=o?n*o:n;e=(0,T.default)(new Uint8Array(d),o?[n,o]:[n,1])}else i==="norm565"?e=(0,T.default)(new Uint16Array(n),[n]):e=(0,T.default)(new Uint32Array(n),[n]);let h=0,r=n,u=0,p=e.shape[0];for(let d=0;d<a.length;d++)p=a[d],r=p-u+h,r>h&&(o?G.assign(e.hi(r,o).lo(h,0),this._quantized.hi(p,o).lo(u,0)):G.assign(e.hi(r).lo(h),this._quantized.hi(p).lo(u))),h=r,u=p+1;return h<n&&(o?G.assign(e.lo(h,0),this._quantized.lo(u,0)):G.assign(e.lo(h),this._quantized.lo(u))),e}pruneFeature(a,s,n){let i=this._createPrunedQuantized(a),e=this._createPrunedMinMax(s);return new U(i,e,this._chunkSize,this._quantizationMethod,n,!0)}static getRequiredNChunks(a,s){return Math.floor(a/s)}static fromArray(a,s,n){let i=a.shape[0],e=Math.floor(i/n),o=(0,T.default)(new Float32Array(e*2),[e,2],[2,1]),h;s==="norm8x"?h=(0,T.default)(new Uint8Array(a.size),a.shape):s==="norm565"?h=(0,T.default)(new Uint16Array(a.shape[0]),[a.shape[0]]):h=(0,T.default)(new Uint32Array(a.shape[0]),[a.shape[0]]);for(let r=0;r<e;r++){let u=r*n,p=r+1<e?(r+1)*n:i,d;a.shape.length>1?d=ct.createFromUnnormalized(a.hi(p,a.shape[1]).lo(u,0)):d=ct.createFromUnnormalized(a.hi(p).lo(u)),o.set(r,0,d.minD),o.set(r,1,d.maxD),h.shape.length>1?G.assign(h.hi(p,h.shape[1]).lo(u,0),L.fromNormalized(d,s).quantized):G.assign(h.hi(p).lo(u),L.fromNormalized(d,s).quantized)}return new U(h,o,n,s)}denormDequant(){let a=this._minMaxMatrix.shape[0],s=this._quantized,n=s.shape[0],i=this._quantizationMethod,e=this._chunkSize,o;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");o=this._variableChunkSize}let h;i==="norm8x"?h=(0,T.default)(new Float32Array(s.size),s.shape):h=(0,T.default)(new Float32Array(n*3),[n,3]);let r=0,u=e;for(let p=0;p<a;p++){let[d,c]=[this._minMaxMatrix.get(p,0),this._minMaxMatrix.get(p,1)];this._isDynamicChunks&&(u=o[p]);let l=p+1<a?r+u:n,y;s.shape.length>1?y=new L(s.hi(l,s.shape[1]).lo(r,0),i):y=new L(s.hi(l).lo(r),i),G.assign(h.hi(l,h.shape[1]).lo(r,0),y.dequantize(d,c).denormalize()),r=l}return h}static async fetchArrayBuffer(a){return await(await fetch(a,{mode:"cors"})).arrayBuffer()}},f(st,"E"),st),H=P(ht()),D=P(ut()),da="http://127.0.0.1:8000",K=P(ht()),I=P(ut()),qt=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function zt(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}f(zt,"ee");function jt(t,a){if(t===a)return 0;if(~~t===t&&~~a===a){if(t===0||a===0)return t<a?-1:1;if(t<0||a<0){if(a>=0)return-1;if(t>=0)return 1;t=-t,a=-a}let i=zt(t),e=zt(a),o=0;return i<e?(t*=qt[e-i-1],a/=10,o=-1):i>e&&(a*=qt[i-e-1],t/=10,o=1),t===a?o:t<a?-1:1}let s=String(t),n=String(a);return s===n?0:s<n?-1:1}f(jt,"ne");function ya(t){let a=0;for(;t>=32;)a|=t&1,t>>=1;return t+a}f(ya,"gn");function Vt(t,a,s,n){let i=a+1;if(i===s)return 1;if(n(t[i++],t[a])<0){for(;i<s&&n(t[i],t[i-1])<0;)i++;ga(t,a,i)}else for(;i<s&&n(t[i],t[i-1])>=0;)i++;return i-a}f(Vt,"ae");function ga(t,a,s){for(s--;a<s;){let n=t[a];t[a++]=t[s],t[s--]=n}}f(ga,"Mn");function St(t,a,s,n,i){for(n===a&&n++;n<s;n++){let e=t[n],o=a,h=n;for(;o<h;){let u=o+h>>>1;i(e,t[u])<0?h=u:o=u+1}let r=n-o;switch(r){case 3:t[o+3]=t[o+2];case 2:t[o+2]=t[o+1];case 1:t[o+1]=t[o];break;default:for(;r>0;)t[o+r]=t[o+r-1],r--}t[o]=e}}f(St,"te");function pt(t,a,s,n,i,e){let o=0,h=0,r=1;if(e(t,a[s+i])>0){for(h=n-i;r<h&&e(t,a[s+i+r])>0;)o=r,r=(r<<1)+1,r<=0&&(r=h);r>h&&(r=h),o+=i,r+=i}else{for(h=i+1;r<h&&e(t,a[s+i-r])<=0;)o=r,r=(r<<1)+1,r<=0&&(r=h);r>h&&(r=h);let u=o;o=i-r,r=i-u}for(o++;o<r;){let u=o+(r-o>>>1);e(t,a[s+u])>0?o=u+1:r=u}return r}f(pt,"Mr");function dt(t,a,s,n,i,e){let o=0,h=0,r=1;if(e(t,a[s+i])<0){for(h=i+1;r<h&&e(t,a[s+i-r])<0;)o=r,r=(r<<1)+1,r<=0&&(r=h);r>h&&(r=h);let u=o;o=i-r,r=i-u}else{for(h=n-i;r<h&&e(t,a[s+i+r])>=0;)o=r,r=(r<<1)+1,r<=0&&(r=h);r>h&&(r=h),o+=i,r+=i}for(o++;o<r;){let u=o+(r-o>>>1);e(t,a[s+u])<0?r=u:o=u+1}return r}f(dt,"_r");var nt,ma=(nt=class{constructor(a,s){R(this,"array",null),R(this,"compare",null),R(this,"minGallop",7),R(this,"length",0),R(this,"tmpStorageLength",256),R(this,"stackLength",0),R(this,"runStart",null),R(this,"runLength",null),R(this,"stackSize",0),this.array=a,this.compare=s,this.length=a.length,this.length<2*256&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}pushRun(a,s){this.runStart[this.stackSize]=a,this.runLength[this.stackSize]=s,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let a=this.stackSize-2;if(a>=1&&this.runLength[a-1]<=this.runLength[a]+this.runLength[a+1]||a>=2&&this.runLength[a-2]<=this.runLength[a]+this.runLength[a-1])this.runLength[a-1]<this.runLength[a+1]&&a--;else if(this.runLength[a]>this.runLength[a+1])break;this.mergeAt(a)}}forceMergeRuns(){for(;this.stackSize>1;){let a=this.stackSize-2;a>0&&this.runLength[a-1]<this.runLength[a+1]&&a--,this.mergeAt(a)}}mergeAt(a){let s=this.compare,n=this.array,i=this.runStart[a],e=this.runLength[a],o=this.runStart[a+1],h=this.runLength[a+1];this.runLength[a]=e+h,a===this.stackSize-3&&(this.runStart[a+1]=this.runStart[a+2],this.runLength[a+1]=this.runLength[a+2]),this.stackSize--;let r=dt(n[o],n,i,e,0,s);i+=r,e-=r,e!==0&&(h=pt(n[i+e-1],n,o,h,h-1,s),h!==0&&(e<=h?this.mergeLow(i,e,o,h):this.mergeHigh(i,e,o,h)))}mergeLow(a,s,n,i){let e=this.compare,o=this.array,h=this.tmp,r=0;for(r=0;r<s;r++)h[r]=o[a+r];let u=0,p=n,d=a;if(o[d++]=o[p++],--i===0){for(r=0;r<s;r++)o[d+r]=h[u+r];return}if(s===1){for(r=0;r<i;r++)o[d+r]=o[p+r];o[d+i]=h[u];return}let c=this.minGallop;for(;;){let l=0,y=0,m=!1;do if(e(o[p],h[u])<0){if(o[d++]=o[p++],y++,l=0,--i===0){m=!0;break}}else if(o[d++]=h[u++],l++,y=0,--s===1){m=!0;break}while((l|y)<c);if(m)break;do{if(l=dt(o[p],h,u,s,0,e),l!==0){for(r=0;r<l;r++)o[d+r]=h[u+r];if(d+=l,u+=l,s-=l,s<=1){m=!0;break}}if(o[d++]=o[p++],--i===0){m=!0;break}if(y=pt(h[u],o,p,i,0,e),y!==0){for(r=0;r<y;r++)o[d+r]=o[p+r];if(d+=y,p+=y,i-=y,i===0){m=!0;break}}if(o[d++]=h[u++],--s===1){m=!0;break}c--}while(l>=7||y>=7);if(m)break;c<0&&(c=0),c+=2}if(this.minGallop=c,c<1&&(this.minGallop=1),s===1){for(r=0;r<i;r++)o[d+r]=o[p+r];o[d+i]=h[u]}else{if(s===0)throw new Error("mergeLow preconditions were not respected");for(r=0;r<s;r++)o[d+r]=h[u+r]}}mergeHigh(a,s,n,i){let e=this.compare,o=this.array,h=this.tmp,r=0;for(r=0;r<i;r++)h[r]=o[n+r];let u=a+s-1,p=i-1,d=n+i-1,c=0,l=0;if(o[d--]=o[u--],--s===0){for(c=d-(i-1),r=0;r<i;r++)o[c+r]=h[r];return}if(i===1){for(d-=s,u-=s,l=d+1,c=u+1,r=s-1;r>=0;r--)o[l+r]=o[c+r];o[d]=h[p];return}let y=this.minGallop;for(;;){let m=0,g=0,b=!1;do if(e(h[p],o[u])<0){if(o[d--]=o[u--],m++,g=0,--s===0){b=!0;break}}else if(o[d--]=h[p--],g++,m=0,--i===1){b=!0;break}while((m|g)<y);if(b)break;do{if(m=s-dt(h[p],o,a,s,s-1,e),m!==0){for(d-=m,u-=m,s-=m,l=d+1,c=u+1,r=m-1;r>=0;r--)o[l+r]=o[c+r];if(s===0){b=!0;break}}if(o[d--]=h[p--],--i===1){b=!0;break}if(g=i-pt(o[u],h,0,i,i-1,e),g!==0){for(d-=g,p-=g,i-=g,l=d+1,c=p+1,r=0;r<g;r++)o[l+r]=h[c+r];if(i<=1){b=!0;break}}if(o[d--]=o[u--],--s===0){b=!0;break}y--}while(m>=7||g>=7);if(b)break;y<0&&(y=0),y+=2}if(this.minGallop=y,y<1&&(this.minGallop=1),i===1){for(d-=s,u-=s,l=d+1,c=u+1,r=s-1;r>=0;r--)o[l+r]=o[c+r];o[d]=h[p]}else{if(i===0)throw new Error("mergeHigh preconditions were not respected");for(c=d-(i-1),r=0;r<i;r++)o[c+r]=h[r]}}},f(nt,"br"),nt);function ba(t,a,s,n){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");a?typeof a!="function"&&(n=s,s=a,a=jt):a=jt,s||(s=0),n||(n=t.length);let i=n-s;if(i<2)return;let e=0;if(i<32){e=Vt(t,s,n,a),St(t,s,n,s+e,a);return}let o=new ma(t,a),h=ya(i);do{if(e=Vt(t,s,n,a),e<h){let r=i;r>h&&(r=h),St(t,s,s+r,s+e,a),e=r}o.pushRun(s,e),o.mergeRuns(),i-=e,s+=e}while(i!==0);o.forceMergeRuns()}f(ba,"se");function yt(t){let a=(0,K.default)(new Int32Array(t.shape[0]),[t.shape[0]]),s=(0,K.default)(new Int32Array(t.shape[0]),[t.shape[0]]);return I.bands(a,t,1023),I.lshifts(s,a,16),I.bxoreq(a,s),I.bandseq(a,4278190335),I.lshifts(s,a,8),I.bxoreq(a,s),I.bandseq(a,50393103),I.lshifts(s,a,4),I.bxoreq(a,s),I.bandseq(a,51130563),I.lshifts(s,a,2),I.bxoreq(a,s),I.bandseq(a,153391689),a}f(yt,"Ar");function _a(t){let a=yt(t.pick(null,0)),s=yt(t.pick(null,1));I.lshiftseq(s,1);let n=yt(t.pick(null,2));return I.lshiftseq(n,2),I.boreq(a,s),I.boreq(a,n),a}f(_a,"_n");function X(t,a){if(t.shape[0]!==a.shape[0])throw new Error("wrong length");let s=(0,K.default)(new Float32Array(t.size),t.shape,t.stride,t.offset);for(let n=0;n<a.shape[0];n++){let i=a.get(n);if(t.shape.length>1)for(let e=0;e<t.shape[1];e++)s.set(n,e,t.get(i,e));else s.set(n,t.get(i))}return s}f(X,"rr");function va(t){let a=I.sup(t),s=I.inf(t),n=1e3/Math.min(1e3,a-s),i=(0,K.default)(new Float32Array(t.data),t.shape);I.mulseq(i,n);let e=(0,K.default)(new Int32Array(i.data),t.shape),o=_a(e),h=Array.from(o.data).map((u,p)=>[u,p]);ba(h,(u,p)=>u[0]-p[0]);let r=h.map(([u,p])=>p);return(0,K.default)(Uint32Array.from(r))}f(va,"wr");var it,Q=(it=class{constructor(a,s,n,i,e,o,h,r,u,p){this.propertyDescs=a,this.format=s,this.nsplats=n,this.xyz=i,this.colors=e,this.harmonics=o,this.opacity=h,this.scaling=r,this.rotation=u,this.maxSHDegree=p}getPlyBinary(){let a=Q._generateHeaderString(this.propertyDescs,this.format,this.nsplats),s=new TextEncoder().encode(a),n=Object.keys(this.propertyDescs).length,i=(0,H.default)(new Float32Array(this.nsplats*n),[this.nsplats,n]);if(D.assign(i.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),D.assign(i.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),D.assign(i.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),D.assign(i.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),D.assign(i.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),D.assign(i.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),D.assign(i.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),D.assign(i.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),D.assign(i.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),D.assign(i.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),D.assign(i.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),D.assign(i.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),D.assign(i.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),D.assign(i.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let h=0;h<this.harmonics.length;h++){let r=h*3;D.assign(i.pick(null,this.propertyDescs[`f_rest_${r}`].index),this.harmonics[h].pick(null,0)),D.assign(i.pick(null,this.propertyDescs[`f_rest_${r+1}`].index),this.harmonics[h].pick(null,1)),D.assign(i.pick(null,this.propertyDescs[`f_rest_${r+2}`].index),this.harmonics[h].pick(null,2))}let e=new Uint8Array(i.data.buffer),o=new Uint8Array(e.length+s.length);return o.set(s),o.set(e,s.length),o.buffer}save(a,s){let n=this.getPlyBinary(),i=new Blob([n],{type:"application/octet-stream"}),e=new File([i],a),o=new FormData;o.append("file",e),o.append("filename",a),o.append("basedir",s),fetch(`${da}/push_file`,{method:"POST",body:o})}static async loadFile(a){return await(await fetch(a)).arrayBuffer()}mortonPositionSplatsSort(){let a=va(this.xyz),s=X(this.xyz,a),n=X(this.colors,a),i=X(this.opacity,a),e=X(this.scaling,a),o=X(this.rotation,a),h=[];for(let r=0;r<this.harmonics.length;r++)h.push(X(this.harmonics[r],a));return new Q(this.propertyDescs,this.format,this.nsplats,s,n,h,i,e,o,this.maxSHDegree)}static _generateHeaderString(a,s,n){let i=`ply
format ${s.format} ${s.version}
element vertex ${n}`,e=Object.keys(a).length,o=Array(e);for(let h in a){let r=a[h];o[r.index]={name:h,dtype:r.dtype}}for(let h=0;h<o.length;h++)i=`${i}
property ${o[h].dtype} ${o[h].name}`;return`${i}
end_header
`}static fromArrayBuffer(a,s=3){let{splatCount:n,vertexData:i,propertiesDesc:e,format:o}=Q.decodeHeader(a),h=i.buffer.slice(i.byteOffset),r=Object.keys(e).length,u=(0,H.default)(new Float32Array(h),[n,r]),p=0,d={},c={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,char:1};for(let M in e)if(e.hasOwnProperty(M)){let x=e[M].dtype;d[M]=p,p+=c[x]}let l=(0,H.default)(new Float32Array(n*3),[n,3]);D.assign(l.pick(null,0),u.pick(null,d.x/4)),D.assign(l.pick(null,1),u.pick(null,d.y/4)),D.assign(l.pick(null,2),u.pick(null,d.z/4));let y=(0,H.default)(new Float32Array(n*3),[n,3]);D.assign(y.pick(null,0),u.pick(null,d.scale_0/4)),D.assign(y.pick(null,1),u.pick(null,d.scale_1/4)),D.assign(y.pick(null,2),u.pick(null,d.scale_2/4));let m=(0,H.default)(new Float32Array(n*3),[n,3]);D.assign(m.pick(null,0),u.pick(null,d.f_dc_0/4)),D.assign(m.pick(null,1),u.pick(null,d.f_dc_1/4)),D.assign(m.pick(null,2),u.pick(null,d.f_dc_2/4));let g=(0,H.default)(new Float32Array(n*4),[n,4]);D.assign(g.pick(null,0),u.pick(null,d.rot_1/4)),D.assign(g.pick(null,1),u.pick(null,d.rot_2/4)),D.assign(g.pick(null,2),u.pick(null,d.rot_3/4)),D.assign(g.pick(null,3),u.pick(null,d.rot_0/4));for(let M=0;M<n;M++){let x=g.pick(M,null),k=Math.sqrt(x.get(0)**2+x.get(1)**2+x.get(2)**2+x.get(3)**2);D.divseq(x,k)}let b=(0,H.default)(new Float32Array(n*1),[n,1]);D.assign(b.pick(null,0),u.pick(null,d.opacity/4)),D.negeq(b),D.expeq(b),D.addseq(b,1),D.recipeq(b),D.mulseq(b,255);let _=(Math.min(Math.max(s,0),3)+1)**2-1,v=[];for(let M=0;M<_;M++){let x=(0,H.default)(new Float32Array(n*3),[n,3]),k=M*3;D.assign(x.pick(null,0),u.pick(null,d[`f_rest_${k}`]/4)),D.assign(x.pick(null,1),u.pick(null,d[`f_rest_${k+1}`]/4)),D.assign(x.pick(null,2),u.pick(null,d[`f_rest_${k+2}`]/4)),v.push(x)}return new Q(e,o,n,l,m,v,b,y,g,s)}static async fromPLYFile(a,s=3){let n=await Q.loadFile(a);return Q.fromArrayBuffer(n,s)}static decodeHeader(a){let s=new TextDecoder,n=0,i="",e=100;for(;;){if(n+e>=a.byteLength)throw new Error("End of file reached while searching for end of header");let l=new Uint8Array(a,n,e);i+=s.decode(l),n+=e;let y=n-e*2,m=new Uint8Array(a,Math.max(0,y),y>0?e*2:e);if(s.decode(m).includes("end_header"))break}let o=i.split(`
`),h=0,r={},u=0,p;for(let l=0;l<o.length;l++){let y=o[l].trim();if(y.startsWith("element vertex")){let m=y.match(/\d+/);m&&(h=parseInt(m[0]))}else if(y.startsWith("property")){let m=y.match(/(\w+)\s+(\w+)\s+(\w+)/);if(m){let g=m[2],b=m[3];r[b]={dtype:g,index:u},u++}}else if(y.startsWith("format")){let m=y.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);m&&(p={format:m[2],version:m[3]})}else if(y==="end_header")break}let d=i.indexOf("end_header")+10+1,c=new DataView(a,d);return{splatCount:h,vertexData:c,headerOffset:n,propertiesDesc:r,format:p}}},f(it,"U"),it),et,bt=(et=class{constructor(a,s,n,i,e,o,h,r){this.config=a,this.xyz=s,this.scaling=n,this.color=i,this.opacity=e,this.harmonics=h,this.quaternion=o,this.variableChunkSize=r}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(a,s){let n=U.fromArray(a.xyz,s.xyz,s.chunkSize),i=U.fromArray(a.scaling,s.scaling,s.chunkSize),e=U.fromArray(a.colors,s.color,s.chunkSize),o=U.fromArray(a.opacity,s.opacity,s.chunkSize),h=U.fromArray(a.rotation,s.quaternion,s.chunkSize),r=a.harmonics,u=[];if(s.harmonics)for(let p=0;p<r.length;p++){let d=U.fromArray(r[p],s.harmonics,s.chunkSize);u.push(d)}return new bt(s,n,i,e,o,h,u)}_countIndexesInChunks(a){let s=[],n=this.nchunks,i=this.chunkSize,e=this.nsplats,o=U.getRequiredNChunks(e,i);if(n===o)for(let h=0;h<a.length;h++){let r=a[h],u=Math.floor(r/this.chunkSize);u in s?s[u].push(r):s[u]=[r]}else{let h=this.variableChunkSize,r={},u=0;for(let p=0;p<n;p++)r[p]=u,u+=h[p];for(let p=0;p<a.length;p++){let d=a[p],c=Math.min(Math.floor(d/i),n-1);for(;d>=r[c]+h[c];)c++;c in s?s[c].push(d):s[c]=[d]}}return s}pruneSplats(a){let s=this._countIndexesInChunks(a),n,i=[];return s.length>0&&(n=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),s.forEach((e,o)=>{n[o]-=e.length,n[o]<=0&&i.push(o)}),n=n.filter(e=>e>0)),new bt(this.config,this.xyz.pruneFeature(a,i,n),this.scaling.pruneFeature(a,i,n),this.color.pruneFeature(a,i,n),this.opacity.pruneFeature(a,i,n),this.quaternion.pruneFeature(a,i,n),this.harmonics?this.harmonics.map(e=>e.pruneFeature(a,i,this.variableChunkSize)):void 0,n)}static async loadConfig(a){return await(await fetch(a,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()}toGaussians(){var e;let a={format:"binary_little_endian",version:"1.0"},s={},n=0;if(s.x={dtype:"float",index:n},n++,s.y={dtype:"float",index:n},n++,s.z={dtype:"float",index:n},n++,s.f_dc_0={dtype:"float",index:n},n++,s.f_dc_1={dtype:"float",index:n},n++,s.f_dc_2={dtype:"float",index:n},n++,this.harmonics&&this.harmonics.length>0)for(let o=0;o<this.harmonics.length;o++)s[`f_rest_${o}`]={dtype:"float",index:n},n++,s[`f_rest_${o+1}`]={dtype:"float",index:n},n++,s[`f_rest_${o+2}`]={dtype:"float",index:n},n++;s.opacity={dtype:"float",index:n},n++,s.scale_0={dtype:"float",index:n},n++,s.scale_1={dtype:"float",index:n},n++,s.scale_2={dtype:"float",index:n},n++,s.rot_0={dtype:"float",index:n},n++,s.rot_1={dtype:"float",index:n},n++,s.rot_2={dtype:"float",index:n},n++,s.rot_3={dtype:"float",index:n},n++;let i=(e=this.harmonics)==null?void 0:e.map(o=>o.denormDequant());return new Q(s,a,this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),i||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},f(et,"X"),et),J=P(ht()),$=P(ut()),F=1e-6,E=typeof Float32Array<"u"?Float32Array:Array,gt=Math.random;Math.hypot||(Math.hypot=function(){for(var t=0,a=arguments.length;a--;)t+=arguments[a]*arguments[a];return Math.sqrt(t)});var Z={};xt(Z,{add:f(()=>Pa,"add"),adjoint:f(()=>Va,"adjoint"),clone:f(()=>xa,"clone"),copy:f(()=>wa,"copy"),create:f(()=>Bt,"create"),determinant:f(()=>Sa,"determinant"),equals:f(()=>Wa,"equals"),exactEquals:f(()=>Ha,"exactEquals"),frob:f(()=>Ta,"frob"),fromMat2d:f(()=>Ca,"fromMat2d"),fromMat4:f(()=>Ma,"fromMat4"),fromQuat:f(()=>Ia,"fromQuat"),fromRotation:f(()=>La,"fromRotation"),fromScaling:f(()=>Ua,"fromScaling"),fromTranslation:f(()=>Ba,"fromTranslation"),fromValues:f(()=>ka,"fromValues"),identity:f(()=>qa,"identity"),invert:f(()=>ja,"invert"),mul:f(()=>Ya,"mul"),multiply:f(()=>Lt,"multiply"),multiplyScalar:f(()=>Ra,"multiplyScalar"),multiplyScalarAndAdd:f(()=>Ga,"multiplyScalarAndAdd"),normalFromMat4:f(()=>Ea,"normalFromMat4"),projection:f(()=>Oa,"projection"),rotate:f(()=>Fa,"rotate"),scale:f(()=>Na,"scale"),set:f(()=>Aa,"set"),str:f(()=>$a,"str"),sub:f(()=>Qa,"sub"),subtract:f(()=>Ut,"subtract"),translate:f(()=>Da,"translate"),transpose:f(()=>za,"transpose")});function Bt(){var t=new E(9);return E!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}f(Bt,"kr");function Ma(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[4],t[4]=a[5],t[5]=a[6],t[6]=a[8],t[7]=a[9],t[8]=a[10],t}f(Ma,"bn");function xa(t){var a=new E(9);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a}f(xa,"An");function wa(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t}f(wa,"wn");function ka(t,a,s,n,i,e,o,h,r){var u=new E(9);return u[0]=t,u[1]=a,u[2]=s,u[3]=n,u[4]=i,u[5]=e,u[6]=o,u[7]=h,u[8]=r,u}f(ka,"kn");function Aa(t,a,s,n,i,e,o,h,r,u){return t[0]=a,t[1]=s,t[2]=n,t[3]=i,t[4]=e,t[5]=o,t[6]=h,t[7]=r,t[8]=u,t}f(Aa,"zn");function qa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}f(qa,"qn");function za(t,a){if(t===a){var s=a[1],n=a[2],i=a[5];t[1]=a[3],t[2]=a[6],t[3]=s,t[5]=a[7],t[6]=n,t[7]=i}else t[0]=a[0],t[1]=a[3],t[2]=a[6],t[3]=a[1],t[4]=a[4],t[5]=a[7],t[6]=a[2],t[7]=a[5],t[8]=a[8];return t}f(za,"Nn");function ja(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=a[4],h=a[5],r=a[6],u=a[7],p=a[8],d=p*o-h*u,c=-p*e+h*r,l=u*e-o*r,y=s*d+n*c+i*l;return y?(y=1/y,t[0]=d*y,t[1]=(-p*n+i*u)*y,t[2]=(h*n-i*o)*y,t[3]=c*y,t[4]=(p*s-i*r)*y,t[5]=(-h*s+i*e)*y,t[6]=l*y,t[7]=(-u*s+n*r)*y,t[8]=(o*s-n*e)*y,t):null}f(ja,"Fn");function Va(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=a[4],h=a[5],r=a[6],u=a[7],p=a[8];return t[0]=o*p-h*u,t[1]=i*u-n*p,t[2]=n*h-i*o,t[3]=h*r-e*p,t[4]=s*p-i*r,t[5]=i*e-s*h,t[6]=e*u-o*r,t[7]=n*r-s*u,t[8]=s*o-n*e,t}f(Va,"Sn");function Sa(t){var a=t[0],s=t[1],n=t[2],i=t[3],e=t[4],o=t[5],h=t[6],r=t[7],u=t[8];return a*(u*e-o*r)+s*(-u*i+o*h)+n*(r*i-e*h)}f(Sa,"In");function Lt(t,a,s){var n=a[0],i=a[1],e=a[2],o=a[3],h=a[4],r=a[5],u=a[6],p=a[7],d=a[8],c=s[0],l=s[1],y=s[2],m=s[3],g=s[4],b=s[5],_=s[6],v=s[7],M=s[8];return t[0]=c*n+l*o+y*u,t[1]=c*i+l*h+y*p,t[2]=c*e+l*r+y*d,t[3]=m*n+g*o+b*u,t[4]=m*i+g*h+b*p,t[5]=m*e+g*r+b*d,t[6]=_*n+v*o+M*u,t[7]=_*i+v*h+M*p,t[8]=_*e+v*r+M*d,t}f(Lt,"ie");function Da(t,a,s){var n=a[0],i=a[1],e=a[2],o=a[3],h=a[4],r=a[5],u=a[6],p=a[7],d=a[8],c=s[0],l=s[1];return t[0]=n,t[1]=i,t[2]=e,t[3]=o,t[4]=h,t[5]=r,t[6]=c*n+l*o+u,t[7]=c*i+l*h+p,t[8]=c*e+l*r+d,t}f(Da,"Cn");function Fa(t,a,s){var n=a[0],i=a[1],e=a[2],o=a[3],h=a[4],r=a[5],u=a[6],p=a[7],d=a[8],c=Math.sin(s),l=Math.cos(s);return t[0]=l*n+c*o,t[1]=l*i+c*h,t[2]=l*e+c*r,t[3]=l*o-c*n,t[4]=l*h-c*i,t[5]=l*r-c*e,t[6]=u,t[7]=p,t[8]=d,t}f(Fa,"Ln");function Na(t,a,s){var n=s[0],i=s[1];return t[0]=n*a[0],t[1]=n*a[1],t[2]=n*a[2],t[3]=i*a[3],t[4]=i*a[4],t[5]=i*a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t}f(Na,"Dn");function Ba(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=a[0],t[7]=a[1],t[8]=1,t}f(Ba,"En");function La(t,a){var s=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=s,t[2]=0,t[3]=-s,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}f(La,"Tn");function Ua(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=a[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}f(Ua,"Pn");function Ca(t,a){return t[0]=a[0],t[1]=a[1],t[2]=0,t[3]=a[2],t[4]=a[3],t[5]=0,t[6]=a[4],t[7]=a[5],t[8]=1,t}f(Ca,"Vn");function Ia(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=s+s,h=n+n,r=i+i,u=s*o,p=n*o,d=n*h,c=i*o,l=i*h,y=i*r,m=e*o,g=e*h,b=e*r;return t[0]=1-d-y,t[3]=p-b,t[6]=c+g,t[1]=p+b,t[4]=1-u-y,t[7]=l-m,t[2]=c-g,t[5]=l+m,t[8]=1-u-d,t}f(Ia,"On");function Ea(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=a[4],h=a[5],r=a[6],u=a[7],p=a[8],d=a[9],c=a[10],l=a[11],y=a[12],m=a[13],g=a[14],b=a[15],_=s*h-n*o,v=s*r-i*o,M=s*u-e*o,x=n*r-i*h,k=n*u-e*h,w=i*u-e*r,A=p*m-d*y,j=p*g-c*y,z=p*b-l*y,q=d*g-c*m,N=d*b-l*m,B=c*b-l*g,V=_*B-v*N+M*q+x*z-k*j+w*A;return V?(V=1/V,t[0]=(h*B-r*N+u*q)*V,t[1]=(r*z-o*B-u*j)*V,t[2]=(o*N-h*z+u*A)*V,t[3]=(i*N-n*B-e*q)*V,t[4]=(s*B-i*z+e*j)*V,t[5]=(n*z-s*N-e*A)*V,t[6]=(m*w-g*k+b*x)*V,t[7]=(g*M-y*w-b*v)*V,t[8]=(y*k-m*M+b*_)*V,t):null}f(Ea,"jn");function Oa(t,a,s){return t[0]=2/a,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/s,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}f(Oa,"Rn");function $a(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}f($a,"Bn");function Ta(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}f(Ta,"Un");function Pa(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t[3]=a[3]+s[3],t[4]=a[4]+s[4],t[5]=a[5]+s[5],t[6]=a[6]+s[6],t[7]=a[7]+s[7],t[8]=a[8]+s[8],t}f(Pa,"Yn");function Ut(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t[3]=a[3]-s[3],t[4]=a[4]-s[4],t[5]=a[5]-s[5],t[6]=a[6]-s[6],t[7]=a[7]-s[7],t[8]=a[8]-s[8],t}f(Ut,"oe");function Ra(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t[4]=a[4]*s,t[5]=a[5]*s,t[6]=a[6]*s,t[7]=a[7]*s,t[8]=a[8]*s,t}f(Ra,"Gn");function Ga(t,a,s,n){return t[0]=a[0]+s[0]*n,t[1]=a[1]+s[1]*n,t[2]=a[2]+s[2]*n,t[3]=a[3]+s[3]*n,t[4]=a[4]+s[4]*n,t[5]=a[5]+s[5]*n,t[6]=a[6]+s[6]*n,t[7]=a[7]+s[7]*n,t[8]=a[8]+s[8]*n,t}f(Ga,"Qn");function Ha(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]}f(Ha,"$n");function Wa(t,a){var s=t[0],n=t[1],i=t[2],e=t[3],o=t[4],h=t[5],r=t[6],u=t[7],p=t[8],d=a[0],c=a[1],l=a[2],y=a[3],m=a[4],g=a[5],b=a[6],_=a[7],v=a[8];return Math.abs(s-d)<=F*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(n-c)<=F*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-l)<=F*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(e-y)<=F*Math.max(1,Math.abs(e),Math.abs(y))&&Math.abs(o-m)<=F*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(h-g)<=F*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(r-b)<=F*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(u-_)<=F*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(p-v)<=F*Math.max(1,Math.abs(p),Math.abs(v))}f(Wa,"Hn");var Ya=Lt,Qa=Ut,_t={};xt(_t,{add:f(()=>Ns,"add"),adjoint:f(()=>ns,"adjoint"),clone:f(()=>Xa,"clone"),copy:f(()=>Ja,"copy"),create:f(()=>Za,"create"),determinant:f(()=>is,"determinant"),equals:f(()=>Cs,"equals"),exactEquals:f(()=>Us,"exactEquals"),frob:f(()=>Fs,"frob"),fromQuat:f(()=>xs,"fromQuat"),fromQuat2:f(()=>ms,"fromQuat2"),fromRotation:f(()=>ps,"fromRotation"),fromRotationTranslation:f(()=>Et,"fromRotationTranslation"),fromRotationTranslationScale:f(()=>vs,"fromRotationTranslationScale"),fromRotationTranslationScaleOrigin:f(()=>Ms,"fromRotationTranslationScaleOrigin"),fromScaling:f(()=>fs,"fromScaling"),fromTranslation:f(()=>cs,"fromTranslation"),fromValues:f(()=>Ka,"fromValues"),fromXRotation:f(()=>ds,"fromXRotation"),fromYRotation:f(()=>ys,"fromYRotation"),fromZRotation:f(()=>gs,"fromZRotation"),frustum:f(()=>ws,"frustum"),getRotation:f(()=>_s,"getRotation"),getScaling:f(()=>Ot,"getScaling"),getTranslation:f(()=>bs,"getTranslation"),identity:f(()=>Ct,"identity"),invert:f(()=>ss,"invert"),lookAt:f(()=>Vs,"lookAt"),mul:f(()=>Is,"mul"),multiply:f(()=>It,"multiply"),multiplyScalar:f(()=>Bs,"multiplyScalar"),multiplyScalarAndAdd:f(()=>Ls,"multiplyScalarAndAdd"),ortho:f(()=>zs,"ortho"),orthoNO:f(()=>Tt,"orthoNO"),orthoZO:f(()=>js,"orthoZO"),perspective:f(()=>ks,"perspective"),perspectiveFromFieldOfView:f(()=>qs,"perspectiveFromFieldOfView"),perspectiveNO:f(()=>$t,"perspectiveNO"),perspectiveZO:f(()=>As,"perspectiveZO"),rotate:f(()=>rs,"rotate"),rotateX:f(()=>hs,"rotateX"),rotateY:f(()=>us,"rotateY"),rotateZ:f(()=>ls,"rotateZ"),scale:f(()=>os,"scale"),set:f(()=>ts,"set"),str:f(()=>Ds,"str"),sub:f(()=>Es,"sub"),subtract:f(()=>Pt,"subtract"),targetTo:f(()=>Ss,"targetTo"),translate:f(()=>es,"translate"),transpose:f(()=>as,"transpose")});function Za(){var t=new E(16);return E!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}f(Za,"Xn");function Xa(t){var a=new E(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}f(Xa,"Kn");function Ja(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}f(Ja,"Jn");function Ka(t,a,s,n,i,e,o,h,r,u,p,d,c,l,y,m){var g=new E(16);return g[0]=t,g[1]=a,g[2]=s,g[3]=n,g[4]=i,g[5]=e,g[6]=o,g[7]=h,g[8]=r,g[9]=u,g[10]=p,g[11]=d,g[12]=c,g[13]=l,g[14]=y,g[15]=m,g}f(Ka,"ra");function ts(t,a,s,n,i,e,o,h,r,u,p,d,c,l,y,m,g){return t[0]=a,t[1]=s,t[2]=n,t[3]=i,t[4]=e,t[5]=o,t[6]=h,t[7]=r,t[8]=u,t[9]=p,t[10]=d,t[11]=c,t[12]=l,t[13]=y,t[14]=m,t[15]=g,t}f(ts,"ea");function Ct(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}f(Ct,"he");function as(t,a){if(t===a){var s=a[1],n=a[2],i=a[3],e=a[6],o=a[7],h=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=s,t[6]=a[9],t[7]=a[13],t[8]=n,t[9]=e,t[11]=a[14],t[12]=i,t[13]=o,t[14]=h}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t}f(as,"na");function ss(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=a[4],h=a[5],r=a[6],u=a[7],p=a[8],d=a[9],c=a[10],l=a[11],y=a[12],m=a[13],g=a[14],b=a[15],_=s*h-n*o,v=s*r-i*o,M=s*u-e*o,x=n*r-i*h,k=n*u-e*h,w=i*u-e*r,A=p*m-d*y,j=p*g-c*y,z=p*b-l*y,q=d*g-c*m,N=d*b-l*m,B=c*b-l*g,V=_*B-v*N+M*q+x*z-k*j+w*A;return V?(V=1/V,t[0]=(h*B-r*N+u*q)*V,t[1]=(i*N-n*B-e*q)*V,t[2]=(m*w-g*k+b*x)*V,t[3]=(c*k-d*w-l*x)*V,t[4]=(r*z-o*B-u*j)*V,t[5]=(s*B-i*z+e*j)*V,t[6]=(g*M-y*w-b*v)*V,t[7]=(p*w-c*M+l*v)*V,t[8]=(o*N-h*z+u*A)*V,t[9]=(n*z-s*N-e*A)*V,t[10]=(y*k-m*M+b*_)*V,t[11]=(d*M-p*k-l*_)*V,t[12]=(h*j-o*q-r*A)*V,t[13]=(s*q-n*j+i*A)*V,t[14]=(m*v-y*x-g*_)*V,t[15]=(p*x-d*v+c*_)*V,t):null}f(ss,"aa");function ns(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=a[4],h=a[5],r=a[6],u=a[7],p=a[8],d=a[9],c=a[10],l=a[11],y=a[12],m=a[13],g=a[14],b=a[15];return t[0]=h*(c*b-l*g)-d*(r*b-u*g)+m*(r*l-u*c),t[1]=-(n*(c*b-l*g)-d*(i*b-e*g)+m*(i*l-e*c)),t[2]=n*(r*b-u*g)-h*(i*b-e*g)+m*(i*u-e*r),t[3]=-(n*(r*l-u*c)-h*(i*l-e*c)+d*(i*u-e*r)),t[4]=-(o*(c*b-l*g)-p*(r*b-u*g)+y*(r*l-u*c)),t[5]=s*(c*b-l*g)-p*(i*b-e*g)+y*(i*l-e*c),t[6]=-(s*(r*b-u*g)-o*(i*b-e*g)+y*(i*u-e*r)),t[7]=s*(r*l-u*c)-o*(i*l-e*c)+p*(i*u-e*r),t[8]=o*(d*b-l*m)-p*(h*b-u*m)+y*(h*l-u*d),t[9]=-(s*(d*b-l*m)-p*(n*b-e*m)+y*(n*l-e*d)),t[10]=s*(h*b-u*m)-o*(n*b-e*m)+y*(n*u-e*h),t[11]=-(s*(h*l-u*d)-o*(n*l-e*d)+p*(n*u-e*h)),t[12]=-(o*(d*g-c*m)-p*(h*g-r*m)+y*(h*c-r*d)),t[13]=s*(d*g-c*m)-p*(n*g-i*m)+y*(n*c-i*d),t[14]=-(s*(h*g-r*m)-o*(n*g-i*m)+y*(n*r-i*h)),t[15]=s*(h*c-r*d)-o*(n*c-i*d)+p*(n*r-i*h),t}f(ns,"ta");function is(t){var a=t[0],s=t[1],n=t[2],i=t[3],e=t[4],o=t[5],h=t[6],r=t[7],u=t[8],p=t[9],d=t[10],c=t[11],l=t[12],y=t[13],m=t[14],g=t[15],b=a*o-s*e,_=a*h-n*e,v=a*r-i*e,M=s*h-n*o,x=s*r-i*o,k=n*r-i*h,w=u*y-p*l,A=u*m-d*l,j=u*g-c*l,z=p*m-d*y,q=p*g-c*y,N=d*g-c*m;return b*N-_*q+v*z+M*j-x*A+k*w}f(is,"sa");function It(t,a,s){var n=a[0],i=a[1],e=a[2],o=a[3],h=a[4],r=a[5],u=a[6],p=a[7],d=a[8],c=a[9],l=a[10],y=a[11],m=a[12],g=a[13],b=a[14],_=a[15],v=s[0],M=s[1],x=s[2],k=s[3];return t[0]=v*n+M*h+x*d+k*m,t[1]=v*i+M*r+x*c+k*g,t[2]=v*e+M*u+x*l+k*b,t[3]=v*o+M*p+x*y+k*_,v=s[4],M=s[5],x=s[6],k=s[7],t[4]=v*n+M*h+x*d+k*m,t[5]=v*i+M*r+x*c+k*g,t[6]=v*e+M*u+x*l+k*b,t[7]=v*o+M*p+x*y+k*_,v=s[8],M=s[9],x=s[10],k=s[11],t[8]=v*n+M*h+x*d+k*m,t[9]=v*i+M*r+x*c+k*g,t[10]=v*e+M*u+x*l+k*b,t[11]=v*o+M*p+x*y+k*_,v=s[12],M=s[13],x=s[14],k=s[15],t[12]=v*n+M*h+x*d+k*m,t[13]=v*i+M*r+x*c+k*g,t[14]=v*e+M*u+x*l+k*b,t[15]=v*o+M*p+x*y+k*_,t}f(It,"ce");function es(t,a,s){var n=s[0],i=s[1],e=s[2],o,h,r,u,p,d,c,l,y,m,g,b;return a===t?(t[12]=a[0]*n+a[4]*i+a[8]*e+a[12],t[13]=a[1]*n+a[5]*i+a[9]*e+a[13],t[14]=a[2]*n+a[6]*i+a[10]*e+a[14],t[15]=a[3]*n+a[7]*i+a[11]*e+a[15]):(o=a[0],h=a[1],r=a[2],u=a[3],p=a[4],d=a[5],c=a[6],l=a[7],y=a[8],m=a[9],g=a[10],b=a[11],t[0]=o,t[1]=h,t[2]=r,t[3]=u,t[4]=p,t[5]=d,t[6]=c,t[7]=l,t[8]=y,t[9]=m,t[10]=g,t[11]=b,t[12]=o*n+p*i+y*e+a[12],t[13]=h*n+d*i+m*e+a[13],t[14]=r*n+c*i+g*e+a[14],t[15]=u*n+l*i+b*e+a[15]),t}f(es,"ia");function os(t,a,s){var n=s[0],i=s[1],e=s[2];return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*i,t[5]=a[5]*i,t[6]=a[6]*i,t[7]=a[7]*i,t[8]=a[8]*e,t[9]=a[9]*e,t[10]=a[10]*e,t[11]=a[11]*e,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}f(os,"oa");function rs(t,a,s,n){var i=n[0],e=n[1],o=n[2],h=Math.hypot(i,e,o),r,u,p,d,c,l,y,m,g,b,_,v,M,x,k,w,A,j,z,q,N,B,V,O;return h<F?null:(h=1/h,i*=h,e*=h,o*=h,r=Math.sin(s),u=Math.cos(s),p=1-u,d=a[0],c=a[1],l=a[2],y=a[3],m=a[4],g=a[5],b=a[6],_=a[7],v=a[8],M=a[9],x=a[10],k=a[11],w=i*i*p+u,A=e*i*p+o*r,j=o*i*p-e*r,z=i*e*p-o*r,q=e*e*p+u,N=o*e*p+i*r,B=i*o*p+e*r,V=e*o*p-i*r,O=o*o*p+u,t[0]=d*w+m*A+v*j,t[1]=c*w+g*A+M*j,t[2]=l*w+b*A+x*j,t[3]=y*w+_*A+k*j,t[4]=d*z+m*q+v*N,t[5]=c*z+g*q+M*N,t[6]=l*z+b*q+x*N,t[7]=y*z+_*q+k*N,t[8]=d*B+m*V+v*O,t[9]=c*B+g*V+M*O,t[10]=l*B+b*V+x*O,t[11]=y*B+_*V+k*O,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)}f(rs,"ha");function hs(t,a,s){var n=Math.sin(s),i=Math.cos(s),e=a[4],o=a[5],h=a[6],r=a[7],u=a[8],p=a[9],d=a[10],c=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=e*i+u*n,t[5]=o*i+p*n,t[6]=h*i+d*n,t[7]=r*i+c*n,t[8]=u*i-e*n,t[9]=p*i-o*n,t[10]=d*i-h*n,t[11]=c*i-r*n,t}f(hs,"ca");function us(t,a,s){var n=Math.sin(s),i=Math.cos(s),e=a[0],o=a[1],h=a[2],r=a[3],u=a[8],p=a[9],d=a[10],c=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=e*i-u*n,t[1]=o*i-p*n,t[2]=h*i-d*n,t[3]=r*i-c*n,t[8]=e*n+u*i,t[9]=o*n+p*i,t[10]=h*n+d*i,t[11]=r*n+c*i,t}f(us,"la");function ls(t,a,s){var n=Math.sin(s),i=Math.cos(s),e=a[0],o=a[1],h=a[2],r=a[3],u=a[4],p=a[5],d=a[6],c=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=e*i+u*n,t[1]=o*i+p*n,t[2]=h*i+d*n,t[3]=r*i+c*n,t[4]=u*i-e*n,t[5]=p*i-o*n,t[6]=d*i-h*n,t[7]=c*i-r*n,t}f(ls,"pa");function cs(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}f(cs,"fa");function fs(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=a[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}f(fs,"ya");function ps(t,a,s){var n=s[0],i=s[1],e=s[2],o=Math.hypot(n,i,e),h,r,u;return o<F?null:(o=1/o,n*=o,i*=o,e*=o,h=Math.sin(a),r=Math.cos(a),u=1-r,t[0]=n*n*u+r,t[1]=i*n*u+e*h,t[2]=e*n*u-i*h,t[3]=0,t[4]=n*i*u-e*h,t[5]=i*i*u+r,t[6]=e*i*u+n*h,t[7]=0,t[8]=n*e*u+i*h,t[9]=i*e*u-n*h,t[10]=e*e*u+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}f(ps,"da");function ds(t,a){var s=Math.sin(a),n=Math.cos(a);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=s,t[7]=0,t[8]=0,t[9]=-s,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}f(ds,"va");function ys(t,a){var s=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=0,t[2]=-s,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=s,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}f(ys,"ma");function gs(t,a){var s=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=s,t[2]=0,t[3]=0,t[4]=-s,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}f(gs,"ua");function Et(t,a,s){var n=a[0],i=a[1],e=a[2],o=a[3],h=n+n,r=i+i,u=e+e,p=n*h,d=n*r,c=n*u,l=i*r,y=i*u,m=e*u,g=o*h,b=o*r,_=o*u;return t[0]=1-(l+m),t[1]=d+_,t[2]=c-b,t[3]=0,t[4]=d-_,t[5]=1-(p+m),t[6]=y+g,t[7]=0,t[8]=c+b,t[9]=y-g,t[10]=1-(p+l),t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1,t}f(Et,"le");function ms(t,a){var s=new E(3),n=-a[0],i=-a[1],e=-a[2],o=a[3],h=a[4],r=a[5],u=a[6],p=a[7],d=n*n+i*i+e*e+o*o;return d>0?(s[0]=(h*o+p*n+r*e-u*i)*2/d,s[1]=(r*o+p*i+u*n-h*e)*2/d,s[2]=(u*o+p*e+h*i-r*n)*2/d):(s[0]=(h*o+p*n+r*e-u*i)*2,s[1]=(r*o+p*i+u*n-h*e)*2,s[2]=(u*o+p*e+h*i-r*n)*2),Et(t,a,s),t}f(ms,"xa");function bs(t,a){return t[0]=a[12],t[1]=a[13],t[2]=a[14],t}f(bs,"ga");function Ot(t,a){var s=a[0],n=a[1],i=a[2],e=a[4],o=a[5],h=a[6],r=a[8],u=a[9],p=a[10];return t[0]=Math.hypot(s,n,i),t[1]=Math.hypot(e,o,h),t[2]=Math.hypot(r,u,p),t}f(Ot,"pe");function _s(t,a){var s=new E(3);Ot(s,a);var n=1/s[0],i=1/s[1],e=1/s[2],o=a[0]*n,h=a[1]*i,r=a[2]*e,u=a[4]*n,p=a[5]*i,d=a[6]*e,c=a[8]*n,l=a[9]*i,y=a[10]*e,m=o+p+y,g=0;return m>0?(g=Math.sqrt(m+1)*2,t[3]=.25*g,t[0]=(d-l)/g,t[1]=(c-r)/g,t[2]=(h-u)/g):o>p&&o>y?(g=Math.sqrt(1+o-p-y)*2,t[3]=(d-l)/g,t[0]=.25*g,t[1]=(h+u)/g,t[2]=(c+r)/g):p>y?(g=Math.sqrt(1+p-o-y)*2,t[3]=(c-r)/g,t[0]=(h+u)/g,t[1]=.25*g,t[2]=(d+l)/g):(g=Math.sqrt(1+y-o-p)*2,t[3]=(h-u)/g,t[0]=(c+r)/g,t[1]=(d+l)/g,t[2]=.25*g),t}f(_s,"Ma");function vs(t,a,s,n){var i=a[0],e=a[1],o=a[2],h=a[3],r=i+i,u=e+e,p=o+o,d=i*r,c=i*u,l=i*p,y=e*u,m=e*p,g=o*p,b=h*r,_=h*u,v=h*p,M=n[0],x=n[1],k=n[2];return t[0]=(1-(y+g))*M,t[1]=(c+v)*M,t[2]=(l-_)*M,t[3]=0,t[4]=(c-v)*x,t[5]=(1-(d+g))*x,t[6]=(m+b)*x,t[7]=0,t[8]=(l+_)*k,t[9]=(m-b)*k,t[10]=(1-(d+y))*k,t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1,t}f(vs,"_a");function Ms(t,a,s,n,i){var e=a[0],o=a[1],h=a[2],r=a[3],u=e+e,p=o+o,d=h+h,c=e*u,l=e*p,y=e*d,m=o*p,g=o*d,b=h*d,_=r*u,v=r*p,M=r*d,x=n[0],k=n[1],w=n[2],A=i[0],j=i[1],z=i[2],q=(1-(m+b))*x,N=(l+M)*x,B=(y-v)*x,V=(l-M)*k,O=(1-(c+b))*k,Y=(g+_)*k,rt=(y+v)*w,kt=(g-_)*w,At=(1-(c+m))*w;return t[0]=q,t[1]=N,t[2]=B,t[3]=0,t[4]=V,t[5]=O,t[6]=Y,t[7]=0,t[8]=rt,t[9]=kt,t[10]=At,t[11]=0,t[12]=s[0]+A-(q*A+V*j+rt*z),t[13]=s[1]+j-(N*A+O*j+kt*z),t[14]=s[2]+z-(B*A+Y*j+At*z),t[15]=1,t}f(Ms,"ba");function xs(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=s+s,h=n+n,r=i+i,u=s*o,p=n*o,d=n*h,c=i*o,l=i*h,y=i*r,m=e*o,g=e*h,b=e*r;return t[0]=1-d-y,t[1]=p+b,t[2]=c-g,t[3]=0,t[4]=p-b,t[5]=1-u-y,t[6]=l+m,t[7]=0,t[8]=c+g,t[9]=l-m,t[10]=1-u-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}f(xs,"Aa");function ws(t,a,s,n,i,e,o){var h=1/(s-a),r=1/(i-n),u=1/(e-o);return t[0]=e*2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e*2*r,t[6]=0,t[7]=0,t[8]=(s+a)*h,t[9]=(i+n)*r,t[10]=(o+e)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*e*2*u,t[15]=0,t}f(ws,"wa");function $t(t,a,s,n,i){var e=1/Math.tan(a/2),o;return t[0]=e/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t}f($t,"fe");var ks=$t;function As(t,a,s,n,i){var e=1/Math.tan(a/2),o;return t[0]=e/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(n-i),t[10]=i*o,t[14]=i*n*o):(t[10]=-1,t[14]=-n),t}f(As,"za");function qs(t,a,s,n){var i=Math.tan(a.upDegrees*Math.PI/180),e=Math.tan(a.downDegrees*Math.PI/180),o=Math.tan(a.leftDegrees*Math.PI/180),h=Math.tan(a.rightDegrees*Math.PI/180),r=2/(o+h),u=2/(i+e);return t[0]=r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-h)*r*.5),t[9]=(i-e)*u*.5,t[10]=n/(s-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*s/(s-n),t[15]=0,t}f(qs,"qa");function Tt(t,a,s,n,i,e,o){var h=1/(a-s),r=1/(n-i),u=1/(e-o);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(a+s)*h,t[13]=(i+n)*r,t[14]=(o+e)*u,t[15]=1,t}f(Tt,"ye");var zs=Tt;function js(t,a,s,n,i,e,o){var h=1/(a-s),r=1/(n-i),u=1/(e-o);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(a+s)*h,t[13]=(i+n)*r,t[14]=e*u,t[15]=1,t}f(js,"Fa");function Vs(t,a,s,n){var i,e,o,h,r,u,p,d,c,l,y=a[0],m=a[1],g=a[2],b=n[0],_=n[1],v=n[2],M=s[0],x=s[1],k=s[2];return Math.abs(y-M)<F&&Math.abs(m-x)<F&&Math.abs(g-k)<F?Ct(t):(p=y-M,d=m-x,c=g-k,l=1/Math.hypot(p,d,c),p*=l,d*=l,c*=l,i=_*c-v*d,e=v*p-b*c,o=b*d-_*p,l=Math.hypot(i,e,o),l?(l=1/l,i*=l,e*=l,o*=l):(i=0,e=0,o=0),h=d*o-c*e,r=c*i-p*o,u=p*e-d*i,l=Math.hypot(h,r,u),l?(l=1/l,h*=l,r*=l,u*=l):(h=0,r=0,u=0),t[0]=i,t[1]=h,t[2]=p,t[3]=0,t[4]=e,t[5]=r,t[6]=d,t[7]=0,t[8]=o,t[9]=u,t[10]=c,t[11]=0,t[12]=-(i*y+e*m+o*g),t[13]=-(h*y+r*m+u*g),t[14]=-(p*y+d*m+c*g),t[15]=1,t)}f(Vs,"Sa");function Ss(t,a,s,n){var i=a[0],e=a[1],o=a[2],h=n[0],r=n[1],u=n[2],p=i-s[0],d=e-s[1],c=o-s[2],l=p*p+d*d+c*c;l>0&&(l=1/Math.sqrt(l),p*=l,d*=l,c*=l);var y=r*c-u*d,m=u*p-h*c,g=h*d-r*p;return l=y*y+m*m+g*g,l>0&&(l=1/Math.sqrt(l),y*=l,m*=l,g*=l),t[0]=y,t[1]=m,t[2]=g,t[3]=0,t[4]=d*g-c*m,t[5]=c*y-p*g,t[6]=p*m-d*y,t[7]=0,t[8]=p,t[9]=d,t[10]=c,t[11]=0,t[12]=i,t[13]=e,t[14]=o,t[15]=1,t}f(Ss,"Ia");function Ds(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}f(Ds,"Ca");function Fs(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}f(Fs,"La");function Ns(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t[3]=a[3]+s[3],t[4]=a[4]+s[4],t[5]=a[5]+s[5],t[6]=a[6]+s[6],t[7]=a[7]+s[7],t[8]=a[8]+s[8],t[9]=a[9]+s[9],t[10]=a[10]+s[10],t[11]=a[11]+s[11],t[12]=a[12]+s[12],t[13]=a[13]+s[13],t[14]=a[14]+s[14],t[15]=a[15]+s[15],t}f(Ns,"Da");function Pt(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t[3]=a[3]-s[3],t[4]=a[4]-s[4],t[5]=a[5]-s[5],t[6]=a[6]-s[6],t[7]=a[7]-s[7],t[8]=a[8]-s[8],t[9]=a[9]-s[9],t[10]=a[10]-s[10],t[11]=a[11]-s[11],t[12]=a[12]-s[12],t[13]=a[13]-s[13],t[14]=a[14]-s[14],t[15]=a[15]-s[15],t}f(Pt,"de");function Bs(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t[4]=a[4]*s,t[5]=a[5]*s,t[6]=a[6]*s,t[7]=a[7]*s,t[8]=a[8]*s,t[9]=a[9]*s,t[10]=a[10]*s,t[11]=a[11]*s,t[12]=a[12]*s,t[13]=a[13]*s,t[14]=a[14]*s,t[15]=a[15]*s,t}f(Bs,"Ea");function Ls(t,a,s,n){return t[0]=a[0]+s[0]*n,t[1]=a[1]+s[1]*n,t[2]=a[2]+s[2]*n,t[3]=a[3]+s[3]*n,t[4]=a[4]+s[4]*n,t[5]=a[5]+s[5]*n,t[6]=a[6]+s[6]*n,t[7]=a[7]+s[7]*n,t[8]=a[8]+s[8]*n,t[9]=a[9]+s[9]*n,t[10]=a[10]+s[10]*n,t[11]=a[11]+s[11]*n,t[12]=a[12]+s[12]*n,t[13]=a[13]+s[13]*n,t[14]=a[14]+s[14]*n,t[15]=a[15]+s[15]*n,t}f(Ls,"Ta");function Us(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]&&t[9]===a[9]&&t[10]===a[10]&&t[11]===a[11]&&t[12]===a[12]&&t[13]===a[13]&&t[14]===a[14]&&t[15]===a[15]}f(Us,"Pa");function Cs(t,a){var s=t[0],n=t[1],i=t[2],e=t[3],o=t[4],h=t[5],r=t[6],u=t[7],p=t[8],d=t[9],c=t[10],l=t[11],y=t[12],m=t[13],g=t[14],b=t[15],_=a[0],v=a[1],M=a[2],x=a[3],k=a[4],w=a[5],A=a[6],j=a[7],z=a[8],q=a[9],N=a[10],B=a[11],V=a[12],O=a[13],Y=a[14],rt=a[15];return Math.abs(s-_)<=F*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(n-v)<=F*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-M)<=F*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(e-x)<=F*Math.max(1,Math.abs(e),Math.abs(x))&&Math.abs(o-k)<=F*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(h-w)<=F*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(r-A)<=F*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(u-j)<=F*Math.max(1,Math.abs(u),Math.abs(j))&&Math.abs(p-z)<=F*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(d-q)<=F*Math.max(1,Math.abs(d),Math.abs(q))&&Math.abs(c-N)<=F*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(l-B)<=F*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(y-V)<=F*Math.max(1,Math.abs(y),Math.abs(V))&&Math.abs(m-O)<=F*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-Y)<=F*Math.max(1,Math.abs(g),Math.abs(Y))&&Math.abs(b-rt)<=F*Math.max(1,Math.abs(b),Math.abs(rt))}f(Cs,"Va");var Is=It,Es=Pt,vt={};xt(vt,{add:f(()=>xn,"add"),calculateW:f(()=>cn,"calculateW"),clone:f(()=>bn,"clone"),conjugate:f(()=>yn,"conjugate"),copy:f(()=>vn,"copy"),create:f(()=>Mt,"create"),dot:f(()=>Xt,"dot"),equals:f(()=>jn,"equals"),exactEquals:f(()=>zn,"exactEquals"),exp:f(()=>Wt,"exp"),fromEuler:f(()=>gn,"fromEuler"),fromMat3:f(()=>Qt,"fromMat3"),fromValues:f(()=>_n,"fromValues"),getAngle:f(()=>rn,"getAngle"),getAxisAngle:f(()=>on,"getAxisAngle"),identity:f(()=>en,"identity"),invert:f(()=>dn,"invert"),len:f(()=>An,"len"),length:f(()=>Jt,"length"),lerp:f(()=>kn,"lerp"),ln:f(()=>Yt,"ln"),mul:f(()=>wn,"mul"),multiply:f(()=>Ht,"multiply"),normalize:f(()=>wt,"normalize"),pow:f(()=>fn,"pow"),random:f(()=>pn,"random"),rotateX:f(()=>hn,"rotateX"),rotateY:f(()=>un,"rotateY"),rotateZ:f(()=>ln,"rotateZ"),rotationTo:f(()=>Vn,"rotationTo"),scale:f(()=>Zt,"scale"),set:f(()=>Mn,"set"),setAxes:f(()=>Dn,"setAxes"),setAxisAngle:f(()=>Gt,"setAxisAngle"),slerp:f(()=>lt,"slerp"),sqlerp:f(()=>Sn,"sqlerp"),sqrLen:f(()=>qn,"sqrLen"),squaredLength:f(()=>Kt,"squaredLength"),str:f(()=>mn,"str")});function Rt(){var t=new E(3);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}f(Rt,"zr");function Os(t){var a=t[0],s=t[1],n=t[2];return Math.hypot(a,s,n)}f(Os,"Ra");function Dt(t,a,s){var n=new E(3);return n[0]=t,n[1]=a,n[2]=s,n}f(Dt,"qr");function $s(t,a){var s=a[0],n=a[1],i=a[2],e=s*s+n*n+i*i;return e>0&&(e=1/Math.sqrt(e)),t[0]=a[0]*e,t[1]=a[1]*e,t[2]=a[2]*e,t}f($s,"ve");function Ts(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]}f(Ts,"me");function mt(t,a,s){var n=a[0],i=a[1],e=a[2],o=s[0],h=s[1],r=s[2];return t[0]=i*r-e*h,t[1]=e*o-n*r,t[2]=n*h-i*o,t}f(mt,"vr");var Ps=Os;(function(){var t=Rt();return function(a,s,n,i,e,o){var h,r;for(s||(s=3),n||(n=0),i?r=Math.min(i*s+n,a.length):r=a.length,h=n;h<r;h+=s)t[0]=a[h],t[1]=a[h+1],t[2]=a[h+2],e(t,t,o),a[h]=t[0],a[h+1]=t[1],a[h+2]=t[2];return a}})();function Rs(){var t=new E(4);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}f(Rs,"Ua");function Gs(t){var a=new E(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a}f(Gs,"xe");function Hs(t,a,s,n){var i=new E(4);return i[0]=t,i[1]=a,i[2]=s,i[3]=n,i}f(Hs,"ge");function Ws(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t}f(Ws,"Me");function Ys(t,a,s,n,i){return t[0]=a,t[1]=s,t[2]=n,t[3]=i,t}f(Ys,"_e");function Qs(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t[3]=a[3]+s[3],t}f(Qs,"be");function Zs(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t}f(Zs,"Ae");function Xs(t){var a=t[0],s=t[1],n=t[2],i=t[3];return Math.hypot(a,s,n,i)}f(Xs,"we");function Js(t){var a=t[0],s=t[1],n=t[2],i=t[3];return a*a+s*s+n*n+i*i}f(Js,"ke");function Ks(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=s*s+n*n+i*i+e*e;return o>0&&(o=1/Math.sqrt(o)),t[0]=s*o,t[1]=n*o,t[2]=i*o,t[3]=e*o,t}f(Ks,"ze");function tn(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]}f(tn,"qe");function an(t,a,s,n){var i=a[0],e=a[1],o=a[2],h=a[3];return t[0]=i+n*(s[0]-i),t[1]=e+n*(s[1]-e),t[2]=o+n*(s[2]-o),t[3]=h+n*(s[3]-h),t}f(an,"Ne");function sn(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]}f(sn,"Fe");function nn(t,a){var s=t[0],n=t[1],i=t[2],e=t[3],o=a[0],h=a[1],r=a[2],u=a[3];return Math.abs(s-o)<=F*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(n-h)<=F*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-r)<=F*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(e-u)<=F*Math.max(1,Math.abs(e),Math.abs(u))}f(nn,"Se");(function(){var t=Rs();return function(a,s,n,i,e,o){var h,r;for(s||(s=4),n||(n=0),i?r=Math.min(i*s+n,a.length):r=a.length,h=n;h<r;h+=s)t[0]=a[h],t[1]=a[h+1],t[2]=a[h+2],t[3]=a[h+3],e(t,t,o),a[h]=t[0],a[h+1]=t[1],a[h+2]=t[2],a[h+3]=t[3];return a}})();function Mt(){var t=new E(4);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}f(Mt,"Nr");function en(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}f(en,"Ga");function Gt(t,a,s){s=s*.5;var n=Math.sin(s);return t[0]=n*a[0],t[1]=n*a[1],t[2]=n*a[2],t[3]=Math.cos(s),t}f(Gt,"Ie");function on(t,a){var s=Math.acos(a[3])*2,n=Math.sin(s/2);return n>F?(t[0]=a[0]/n,t[1]=a[1]/n,t[2]=a[2]/n):(t[0]=1,t[1]=0,t[2]=0),s}f(on,"Qa");function rn(t,a){var s=Xt(t,a);return Math.acos(2*s*s-1)}f(rn,"$a");function Ht(t,a,s){var n=a[0],i=a[1],e=a[2],o=a[3],h=s[0],r=s[1],u=s[2],p=s[3];return t[0]=n*p+o*h+i*u-e*r,t[1]=i*p+o*r+e*h-n*u,t[2]=e*p+o*u+n*r-i*h,t[3]=o*p-n*h-i*r-e*u,t}f(Ht,"Ce");function hn(t,a,s){s*=.5;var n=a[0],i=a[1],e=a[2],o=a[3],h=Math.sin(s),r=Math.cos(s);return t[0]=n*r+o*h,t[1]=i*r+e*h,t[2]=e*r-i*h,t[3]=o*r-n*h,t}f(hn,"Ha");function un(t,a,s){s*=.5;var n=a[0],i=a[1],e=a[2],o=a[3],h=Math.sin(s),r=Math.cos(s);return t[0]=n*r-e*h,t[1]=i*r+o*h,t[2]=e*r+n*h,t[3]=o*r-i*h,t}f(un,"Wa");function ln(t,a,s){s*=.5;var n=a[0],i=a[1],e=a[2],o=a[3],h=Math.sin(s),r=Math.cos(s);return t[0]=n*r+i*h,t[1]=i*r-n*h,t[2]=e*r+o*h,t[3]=o*r-e*h,t}f(ln,"Za");function cn(t,a){var s=a[0],n=a[1],i=a[2];return t[0]=s,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-s*s-n*n-i*i)),t}f(cn,"Xa");function Wt(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=Math.sqrt(s*s+n*n+i*i),h=Math.exp(e),r=o>0?h*Math.sin(o)/o:0;return t[0]=s*r,t[1]=n*r,t[2]=i*r,t[3]=h*Math.cos(o),t}f(Wt,"Le");function Yt(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=Math.sqrt(s*s+n*n+i*i),h=o>0?Math.atan2(o,e)/o:0;return t[0]=s*h,t[1]=n*h,t[2]=i*h,t[3]=.5*Math.log(s*s+n*n+i*i+e*e),t}f(Yt,"De");function fn(t,a,s){return Yt(t,a),Zt(t,t,s),Wt(t,t),t}f(fn,"Ka");function lt(t,a,s,n){var i=a[0],e=a[1],o=a[2],h=a[3],r=s[0],u=s[1],p=s[2],d=s[3],c,l,y,m,g;return l=i*r+e*u+o*p+h*d,l<0&&(l=-l,r=-r,u=-u,p=-p,d=-d),1-l>F?(c=Math.acos(l),y=Math.sin(c),m=Math.sin((1-n)*c)/y,g=Math.sin(n*c)/y):(m=1-n,g=n),t[0]=m*i+g*r,t[1]=m*e+g*u,t[2]=m*o+g*p,t[3]=m*h+g*d,t}f(lt,"mr");function pn(t){var a=gt(),s=gt(),n=gt(),i=Math.sqrt(1-a),e=Math.sqrt(a);return t[0]=i*Math.sin(2*Math.PI*s),t[1]=i*Math.cos(2*Math.PI*s),t[2]=e*Math.sin(2*Math.PI*n),t[3]=e*Math.cos(2*Math.PI*n),t}f(pn,"Ja");function dn(t,a){var s=a[0],n=a[1],i=a[2],e=a[3],o=s*s+n*n+i*i+e*e,h=o?1/o:0;return t[0]=-s*h,t[1]=-n*h,t[2]=-i*h,t[3]=e*h,t}f(dn,"rt");function yn(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=a[3],t}f(yn,"et");function Qt(t,a){var s=a[0]+a[4]+a[8],n;if(s>0)n=Math.sqrt(s+1),t[3]=.5*n,n=.5/n,t[0]=(a[5]-a[7])*n,t[1]=(a[6]-a[2])*n,t[2]=(a[1]-a[3])*n;else{var i=0;a[4]>a[0]&&(i=1),a[8]>a[i*3+i]&&(i=2);var e=(i+1)%3,o=(i+2)%3;n=Math.sqrt(a[i*3+i]-a[e*3+e]-a[o*3+o]+1),t[i]=.5*n,n=.5/n,t[3]=(a[e*3+o]-a[o*3+e])*n,t[e]=(a[e*3+i]+a[i*3+e])*n,t[o]=(a[o*3+i]+a[i*3+o])*n}return t}f(Qt,"Ee");function gn(t,a,s,n){var i=.5*Math.PI/180;a*=i,s*=i,n*=i;var e=Math.sin(a),o=Math.cos(a),h=Math.sin(s),r=Math.cos(s),u=Math.sin(n),p=Math.cos(n);return t[0]=e*r*p-o*h*u,t[1]=o*h*p+e*r*u,t[2]=o*r*u-e*h*p,t[3]=o*r*p+e*h*u,t}f(gn,"nt");function mn(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}f(mn,"at");var bn=Gs,_n=Hs,vn=Ws,Mn=Ys,xn=Qs,wn=Ht,Zt=Zs,Xt=tn,kn=an,Jt=Xs,An=Jt,Kt=Js,qn=Kt,wt=Ks,zn=sn,jn=nn,Vn=function(){var t=Rt(),a=Dt(1,0,0),s=Dt(0,1,0);return function(n,i,e){var o=Ts(i,e);return o<-.999999?(mt(t,a,i),Ps(t)<1e-6&&mt(t,s,i),$s(t,t),Gt(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(mt(t,i,e),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,wt(n,n))}}(),Sn=function(){var t=Mt(),a=Mt();return function(s,n,i,e,o,h){return lt(t,n,o,h),lt(a,i,e,h),lt(s,t,a,2*h*(1-h)),s}}(),Dn=function(){var t=Bt();return function(a,s,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-s[0],t[5]=-s[1],t[8]=-s[2],wt(a,Qt(a,t))}}(),Ft={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},ot,Nt=(ot=class{constructor(a){this.version="",this._buffer=a}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let a=.28209479177387814,s=this.decoded.color.denormDequant(),n=this.decoded.opacity.denormDequant(),i=(0,J.default)(new Float32Array(s.shape[0]*4),[s.shape[0],4]);return $.mulseq(s,a),$.addseq(s,.5),$.mulseq(s,255),$.maxseq(s,0),$.minseq(s,255),this.version===""&&($.negeq(n),$.expeq(n),$.addseq(n,1),$.recipeq(n),$.mulseq(n,255)),$.assign(i.hi(s.shape[0],3).lo(0,0),s),$.assign(i.hi(s.shape[0],4).lo(0,3),n),(0,J.default)(new Uint8Array(i.data),[s.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:a,chunkCount:s,chunkSize:n,typeChunks:i,vertexData:e,propertiesDesc:o,version:h}=this.decodeHeader();this.version=h;let r={xyz:o.xyz.compressionMethod,color:o.color.compressionMethod,opacity:o.opacity.compressionMethod,scaling:o.scaling.compressionMethod,quaternion:o.quaternion.compressionMethod,chunkSize:n};o.harmonics_0&&(r.harmonics=o.harmonics_0.compressionMethod);let u=e.byteOffset,p=Array(Object.keys(o).length);for(let _ in o)p[o[_].index]={name:_,method:o[_].compressionMethod};let d=s*2*4,c=u,l=i==="dynamic"?s*2:0,y,m=!1;if(l>0){let _=new Uint16Array(e.buffer.slice(c,c+l));c+=l,y=Array.from(_),m=!0}let g={};for(let _ of p){let v=0,M=!0;if(_.method==="norm8x")v=a*1*Ft[_.name];else if(_.method==="norm11")v=a*4;else if(_.method==="norm565")v=a*2;else throw M=!1,new Error(`Not Implemented format: ${_.method}`);let x;if(M){let A=e.buffer.slice(c,c+d);x=(0,J.default)(new Float32Array(A),[s,2]),c+=d}else throw new Error("loading chunk byt hasnot minmax!");let k=e.buffer.slice(c,c+v);c+=v;let w;if(_.method==="norm8x")w=(0,J.default)(new Uint8Array(k),[a,Ft[_.name]]);else if(_.method==="norm11")w=(0,J.default)(new Uint32Array(k));else if(_.method==="norm565")w=(0,J.default)(new Uint16Array(k));else throw new Error(`Not Implemented format: ${_.method}`);g[_.name]=new U(w,x,n,_.method,y,m)}let b=[];for(let _=0;_<15;_++){let v=g[`harmonics_${_}`];v&&(b.push(v),delete g[`harmonics_${_}`])}return b.length>0&&(g.harmonics=b),new bt(r,g.xyz,g.scaling,g.color,g.opacity,g.quaternion,g.harmonics,y)}buildPreComputedBuffers(){let a=this.decoded,s=a.nsplats,n=new ArrayBuffer(24*s),i=new Float32Array(n),e=a.scaling.denormDequant(),o=a.quaternion.denormDequant(),h=vt.create(),r=Z.create(),u=Z.create(),p=Z.create(),d=_t.create();for(let c=0;c<s;c++){_t.fromScaling(d,[Math.exp(e.get(c,0)),Math.exp(e.get(c,1)),Math.exp(e.get(c,2))]),Z.fromMat4(u,d),vt.set(h,o.get(c,0),o.get(c,1),o.get(c,2),o.get(c,3)),Z.fromQuat(r,h),Z.multiply(p,r,u);let l=p;i[6*c]=l[0]*l[0]+l[3]*l[3]+l[6]*l[6],i[6*c+1]=l[0]*l[1]+l[3]*l[4]+l[6]*l[7],i[6*c+2]=l[0]*l[2]+l[3]*l[5]+l[6]*l[8],i[6*c+3]=l[1]*l[1]+l[4]*l[4]+l[7]*l[7],i[6*c+4]=l[1]*l[2]+l[4]*l[5]+l[7]*l[8],i[6*c+5]=l[2]*l[2]+l[5]*l[5]+l[8]*l[8]}this._precomputedCovarianceBufferData=n}decodeHeader(){let a=this._buffer,s=new TextDecoder,n=0,i="",e=100;for(;;){if(n+e>=a.byteLength)throw new Error("End of file reached while searching for end of header");let g=new Uint8Array(a,n,e);i+=s.decode(g),n+=e;let b=n-e*2,_=new Uint8Array(a,Math.max(0,b),b>=0?e*2:e);if(s.decode(_).includes("end_header"))break}let o=i.split(`
`),h=0,r=0,u=0,p=0,d="",c="",l={};for(let g=0;g<o.length;g++){let b=o[g].trim();if(b.startsWith("version"))c=b.split(" ")[1]??"";else if(b.startsWith("element vertex")){let _=b.match(/\d+/);_&&(h=parseInt(_[0]))}else if(b.startsWith("property")){let _=b.match(/(\w+)\s+(\w+)\s+(\w+)/);if(_){let v=_[2],M=_[3];l[v]={compressionMethod:M,index:p},p++}}else if(b.startsWith("element chunks")){let _=b.match(/\d+/);_&&(r=parseInt(_[0]))}else if(b.startsWith("element chunkSize")){let _=b.match(/\d+/);_&&(u=parseInt(_[0]))}else if(b.startsWith("element typeChunks")){let _=b.match(/(\w+)\s+(\w+)\s+(\w+)/);_&&(d=_[3])}else if(b==="end_header")break}let y=i.indexOf("end_header")+10+1,m=new DataView(a,y);return{splatCount:h,chunkCount:r,chunkSize:u,typeChunks:d,vertexData:m,propertiesDesc:l,version:c}}pruneSplats(a){let s=this.decodeBuffer().pruneSplats(a);return Nt.fromCompressedGaussianSplats(s,this.version)}static fromCompressedGaussianSplats(a,s){let n=a.xyz.length,i=a.xyz.nchunks,e=`gspline
version ${s}
element vertex ${n}
element chunks ${i}
element chunkSize ${a.chunkSize}
element typeChunks ${a.isDynamicChunks?"dynamic":"static"}
property xyz ${a.xyz.method}
property color ${a.color.method}
property opacity ${a.opacity.method}
property scaling ${a.scaling.method}
property quaternion ${a.quaternion.method}`;if(a.harmonics&&a.harmonics.length>0)for(let j=0;j<a.harmonics.length;j++)e=`${e}
property harmonics_${j} ${a.harmonics[j].method}`;e=`${e}
end_header
`;let o=new TextEncoder().encode(e),h=i*2*4,r=a.xyz.quantized.data.buffer.byteLength,u=a.xyz instanceof U?h:0,p=a.color.quantized.data.buffer.byteLength,d=a.color instanceof U?h:0,c=a.opacity.quantized.data.buffer.byteLength,l=a.opacity instanceof U?h:0,y=a.scaling.quantized.data.buffer.byteLength,m=a.scaling instanceof U?h:0,g=a.quaternion.quantized.data.buffer.byteLength,b=a.quaternion instanceof U?h:0,_=a.variableChunkSize?Uint16Array.from(a.variableChunkSize):void 0,v=_?_.byteLength:0,M=o.byteLength+v+r+u+p+d+c+l+y+m+g+b,x=0,k=0;if(a.harmonics&&a.harmonics.length>0)for(let j=0;j<a.harmonics.length;j++)x+=a.harmonics[j].quantized.data.buffer.byteLength,k+=a.harmonics[j]instanceof U?h:0;x=0,k=0,M+=x+k;let w=new Uint8Array(M),A=0;if(w.set(o,A),A+=o.byteLength,v>0&&(w.set(new Uint8Array(_.buffer),A),A+=v),a.xyz instanceof U&&(w.set(new Uint8Array(a.xyz.minmaxMatrix.data.buffer),A),A+=h),w.set(new Uint8Array(a.xyz.quantized.data.buffer),A),A+=r,a.color instanceof U&&(w.set(new Uint8Array(a.color.minmaxMatrix.data.buffer),A),A+=h),w.set(new Uint8Array(a.color.quantized.data.buffer),A),A+=p,a.opacity instanceof U&&(w.set(new Uint8Array(a.opacity.minmaxMatrix.data.buffer),A),A+=h),w.set(new Uint8Array(a.opacity.quantized.data.buffer),A),A+=c,a.scaling instanceof U&&(w.set(new Uint8Array(a.scaling.minmaxMatrix.data.buffer),A),A+=h),w.set(new Uint8Array(a.scaling.quantized.data.buffer),A),A+=y,a.quaternion instanceof U&&(w.set(new Uint8Array(a.quaternion.minmaxMatrix.data.buffer),A),A+=h),w.set(new Uint8Array(a.quaternion.quantized.data.buffer),A),A+=g,x>0&&a.harmonics&&a.harmonics.length>0)for(let j=0;j<a.harmonics.length;j++){let z=a.harmonics[j];z instanceof U&&(w.set(new Uint8Array(z.minmaxMatrix.data.buffer),A),A+=h),w.set(new Uint8Array(z.quantized.data.buffer),A),A+=z.quantized.data.byteLength}return new Nt(w.buffer)}},f(ot,"ar"),ot);export{bt as CompressedGaussianSplats,Nt as GSplineBuffer,Q as GaussianPLYData};
